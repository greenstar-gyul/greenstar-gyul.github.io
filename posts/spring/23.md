# ğŸŸ¡ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ - (5) MyBatis

## âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ì˜ ë°œì „ ê³¼ì •

> **ì›ì‹œ JDBC â†’ MyBatis â†’ JPA** ìˆœìœ¼ë¡œ ë°œì „í•´ì˜¨ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ê¸°ìˆ !
> **MyBatis**ëŠ” **SQLì„ ì§ì ‘ ì œì–´í•˜ë©´ì„œë„ í¸ë¦¬í•¨ì„ ì œê³µ**í•˜ëŠ” ì¤‘ê°„ ì§€ì ! ğŸ—„ï¸

---

## ğŸ“Œ JDBCì˜ ë¬¸ì œì ê³¼ MyBatisì˜ í•´ê²°ì±…

### ğŸ˜± ìˆœìˆ˜ JDBCì˜ ì§€ì˜¥

**âŒ ë³µì¡í•˜ê³  ë°˜ë³µì ì¸ JDBC ì½”ë“œ**

```java
public void insert(EmpVO vo) {
    Connection conn = null;
    PreparedStatement pstmt = null;
    
    try {
        // 1. ì—°ê²° ìƒì„±
        conn = ds.getConnection();
        
        // 2. íŠ¸ëœì­ì…˜ ì‹œì‘
        conn.setAutoCommit(false);
        
        // 3. SQL ì¤€ë¹„
        String sql = "INSERT INTO EMPLOYEES VALUES (?, ?, ?)";
        pstmt = conn.prepareStatement(sql);
        pstmt.setString(1, vo.getEmployeeNo());
        pstmt.setString(2, vo.getFirstName());
        pstmt.setString(3, vo.getLastName());
        
        // 4. ì‹¤í–‰
        pstmt.executeUpdate();
        
        // 5. ì»¤ë°‹
        conn.commit();
        
    } catch (Exception e) {
        // 6. ë¡¤ë°±
        if (conn != null) {
            try { 
                conn.rollback(); 
            } catch (SQLException e1) { }
        }
    } finally {
        // 7. ë¦¬ì†ŒìŠ¤ ì •ë¦¬
        if (pstmt != null) try { pstmt.close(); } catch (SQLException e) { }
        if (conn != null) try { conn.close(); } catch (SQLException e) { }
    }
}
```

### âœ… MyBatisì˜ í˜ì‹ 

**ğŸŒŸ ê°„ë‹¨í•˜ê³  ëª…í™•í•œ MyBatis ì½”ë“œ**

```java
// DAO ì¸í„°í˜ì´ìŠ¤
public interface EmpMapper {
    void insertEmp(EmpVO vo);
}

// ì‚¬ìš©í•˜ëŠ” Service
@Service
public class EmpService {
    
    @Autowired
    private EmpMapper empMapper;
    
    public void registerEmployee(EmpVO vo) {
        empMapper.insertEmp(vo);  // ë‹¨ í•œ ì¤„!
    }
}
```

```xml
<!-- EmpMapper.xml -->
<mapper namespace="com.example.mapper.EmpMapper">
    <insert id="insertEmp" parameterType="EmpVO">
        INSERT INTO EMPLOYEES (employee_no, first_name, last_name)
        VALUES (#{employeeNo}, #{firstName}, #{lastName})
    </insert>
</mapper>
```

---

## ğŸ”§ MyBatis ì£¼ìš” ì¥ì 

### ğŸ“Œ MyBatisê°€ í•´ê²°í•˜ëŠ” ê²ƒë“¤

| JDBCì˜ ë¬¸ì œì                | MyBatisì˜ í•´ê²°ì±…                    |
| ----------------------- | ------------------------------- |
| **ë³µì¡í•œ ì—°ê²° ê´€ë¦¬**           | **ìë™ ì—°ê²° ê´€ë¦¬** (Connection Pool)   |
| **ë°˜ë³µì ì¸ try-catch-finally** | **ìë™ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬**                   |
| **SQLê³¼ ìë°” ì½”ë“œ ì„ì„**        | **SQLì„ XMLë¡œ ë¶„ë¦¬** ê´€ë¦¬             |
| **ìˆ˜ë™ ê°ì²´ ë§¤í•‘**            | **ìë™ ResultSet â†’ ê°ì²´ ë§¤í•‘**        |
| **íŒŒë¼ë¯¸í„° ì„¤ì •ì˜ ë²ˆê±°ë¡œì›€**        | **#{} ë¬¸ë²•ìœ¼ë¡œ ê°„í¸í•œ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©**      |

### ğŸ¯ MyBatis í•µì‹¬ íŠ¹ì§•

* **JDBCì˜ ëª¨ë“  ê¸°ëŠ¥ì„ MyBatisê°€ ëŒ€ë¶€ë¶„ ì œê³µ** â†’ í•œ ë‘ ì¤„ì˜ ìë°” ì½”ë“œë¡œ DB ì—°ë™ ì²˜ë¦¬
* **SQL ëª…ë ¹ì–´ë¥¼ ìë°”ì½”ë“œì—ì„œ ë¶„ë¦¬í•˜ì—¬ XMLë¡œ ë”°ë¡œ ê´€ë¦¬**
* **XML íŒŒì¼ì— ì €ì¥ëœ SQL ëª…ë ¹ì–´ë¥¼ ëŒ€ì‹  ì‹¤í–‰í•˜ê³  ì‹¤í–‰ê²°ê³¼ë¥¼ VO ê°™ì€ ìë°” ê°ì²´ì— ìë™ìœ¼ë¡œ ë§¤í•‘**

---

## ğŸ—ï¸ MyBatis ì•„í‚¤í…ì²˜

### ğŸ“Œ MyBatis ì£¼ìš” ì»´í¬ë„ŒíŠ¸

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                      â”‚
â”‚                     (Controller)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Business Layer                          â”‚
â”‚              Service â†â†’ ServiceImpl                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Persistence Layer                        â”‚
â”‚                  Dao â†â†’ DaoImpl                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MyBatis Framework                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚mapper.xml   â”‚ â”‚SqlSession   â”‚ â”‚ SqlSessionFactory       â”‚â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚                         â”‚â”‚
â”‚  â”‚jdbc.        â”‚ â”‚             â”‚ â”‚ SqlMapConfig.xml        â”‚â”‚
â”‚  â”‚properties   â”‚ â”‚             â”‚ â”‚                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DB                                   â”‚
â”‚                 JDBC (ì˜¤ë¼í´ í†µì‹ )                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ” ì»´í¬ë„ŒíŠ¸ë³„ ì—­í• 

| ì»´í¬ë„ŒíŠ¸               | ì—­í•                            |
| ------------------ | ---------------------------- |
| **SqlSessionFactory** | **SqlSessionì„ ìƒì„±í•˜ëŠ” íŒ©í† ë¦¬**     |
| **SqlSession**     | **ì‹¤ì œ SQLì„ ì‹¤í–‰í•˜ëŠ” ê°ì²´**         |
| **Mapper XML**     | **SQL ì¿¼ë¦¬ì™€ ë§¤í•‘ ì •ë³´ë¥¼ ë‹´ì€ íŒŒì¼**    |
| **Mapper Interface** | **SQL ì‹¤í–‰ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤**        |
| **SqlMapConfig.xml** | **MyBatis ì „ì—­ ì„¤ì • íŒŒì¼**        |

---

## âš™ï¸ MyBatis ì„¤ì • ë‹¨ê³„ë³„ ê°€ì´ë“œ

### ğŸ“Œ 1ë‹¨ê³„: ì˜ì¡´ì„± ì¶”ê°€ (pom.xml)

```xml
<properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <springframework.version>6.2.7</springframework.version>
</properties>

<!-- Database connection pool -->
<dependency>
    <groupId>com.zaxxer</groupId>
    <artifactId>HikariCP</artifactId>
    <version>6.3.0</version>
</dependency>

<!-- spring-jdbc (spring-tx í¬í•¨ë¨) -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>${springframework.version}</version>
</dependency>

<!-- MyBatis -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.13</version>
</dependency>

<!-- MyBatis-Spring -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis-spring</artifactId>
    <version>3.0.3</version>
</dependency>

<!-- Oracle JDBC Driver -->
<dependency>
    <groupId>com.oracle.database.jdbc</groupId>
    <artifactId>ojdbc8</artifactId>
    <version>23.2.0.0</version>
</dependency>
```

### ğŸ“Œ 2ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸

```java
package com.yedam.web;

import java.sql.Connection;
import java.sql.DriverManager;
import org.junit.Test;

public class ConnectionTest {
    static {
        try {
            Class.forName("oracle.jdbc.driver.OracleDriver");
        } catch(Exception e) {
            e.printStackTrace();
        }
    }
    
    @Test
    public void testConnection() {
        try(Connection con = DriverManager.getConnection(
            "jdbc:oracle:thin:@localhost:1521:xe", "hr", "hr")) {
            
            System.out.println("ì—°ê²° ì„±ê³µ: " + con);
            
        } catch(Exception e) {
            System.out.println("ì—°ê²° ì‹¤íŒ¨: " + e.getMessage());
        }
    }
}
```

### ğŸ“Œ 3ë‹¨ê³„: ìŠ¤í”„ë§ ì„¤ì • (datasource-context.xml)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mybatis-spring="http://mybatis.org/schema/mybatis-spring"
       xsi:schemaLocation="
           http://mybatis.org/schema/mybatis-spring 
           http://mybatis.org/schema/mybatis-spring-1.2.xsd
           http://www.springframework.org/schema/context 
           https://www.springframework.org/schema/context/spring-context.xsd
           http://www.springframework.org/schema/beans 
           https://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- 1. HikariCP ì„¤ì • -->
    <bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
        <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver" />
        <property name="jdbcUrl" value="jdbc:oracle:thin:@127.0.0.1:1521:xe" />
        <property name="username" value="hr" />
        <property name="password" value="hr" />
        
        <!-- ì»¤ë„¥ì…˜ í’€ ì„¤ì • -->
        <property name="maximumPoolSize" value="20" />
        <property name="minimumIdle" value="5" />
        <property name="connectionTimeout" value="30000" />
        <property name="idleTimeout" value="600000" />
    </bean>
    
    <!-- 2. DataSource ì„¤ì • -->
    <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource" 
          destroy-method="close">
        <constructor-arg ref="hikariConfig" />
    </bean>
    
    <!-- 3. SqlSessionFactory ì„¤ì • -->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="mapperLocations" value="classpath:mapper/**/*.xml" />
        <property name="typeAliasesPackage" value="com.example.vo" />
    </bean>
    
    <!-- 4. Mapper ìŠ¤ìº” ì„¤ì • -->
    <mybatis-spring:scan base-package="com.example.mapper" />
    
</beans>
```

---

## ğŸ—‚ï¸ VO(Value Object) ì‘ì„±

### ğŸ“Œ User VO ì˜ˆì‹œ

```java
package com.example.vo;

import java.util.Date;

public class UserVO {
    private Long userId;
    private String username;
    private String email;
    private String password;
    private Date createdDate;
    private String status;
    
    // ê¸°ë³¸ ìƒì„±ì
    public UserVO() {}
    
    // ìƒì„±ì
    public UserVO(String username, String email, String password) {
        this.username = username;
        this.email = email;
        this.password = password;
    }
    
    // Getter & Setter
    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }
    
    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
    
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    
    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }
    
    public Date getCreatedDate() { return createdDate; }
    public void setCreatedDate(Date createdDate) { this.createdDate = createdDate; }
    
    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }
    
    @Override
    public String toString() {
        return "UserVO{" +
                "userId=" + userId +
                ", username='" + username + '\'' +
                ", email='" + email + '\'' +
                ", status='" + status + '\'' +
                ", createdDate=" + createdDate +
                '}';
    }
}
```

---

## ğŸ¯ Mapper ì¸í„°í˜ì´ìŠ¤ ì‘ì„±

### ğŸ“Œ UserMapper ì¸í„°í˜ì´ìŠ¤

```java
package com.example.mapper;

import com.example.vo.UserVO;
import java.util.List;
import java.util.Map;

public interface UserMapper {
    
    // ì‚¬ìš©ì ë“±ë¡
    int insertUser(UserVO user);
    
    // ì‚¬ìš©ì ì¡°íšŒ
    UserVO selectUser(Long userId);
    UserVO selectUserByUsername(String username);
    
    // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
    List<UserVO> selectAllUsers();
    List<UserVO> selectUsersByStatus(String status);
    
    // ì‚¬ìš©ì ìˆ˜ì •
    int updateUser(UserVO user);
    int updateUserStatus(Map<String, Object> params);
    
    // ì‚¬ìš©ì ì‚­ì œ
    int deleteUser(Long userId);
    
    // ì‚¬ìš©ì ìˆ˜ ì¡°íšŒ
    int countUsers();
    int countUsersByStatus(String status);
    
    // í˜ì´ì§• ì¡°íšŒ
    List<UserVO> selectUsersWithPaging(Map<String, Object> params);
}
```

---

## ğŸ“ Mapper XML ì‘ì„±

### ğŸ“Œ UserMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.UserMapper">

    <!-- 1. ì‚¬ìš©ì ë“±ë¡ -->
    <insert id="insertUser" parameterType="UserVO">
        <selectKey keyProperty="userId" resultType="Long" order="BEFORE">
            SELECT USER_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO USERS (
            user_id, username, email, password, created_date, status
        ) VALUES (
            #{userId}, #{username}, #{email}, #{password}, SYSDATE, 'ACTIVE'
        )
    </insert>
    
    <!-- 2. ì‚¬ìš©ì ì¡°íšŒ -->
    <select id="selectUser" parameterType="Long" resultType="UserVO">
        SELECT user_id, username, email, password, created_date, status
        FROM USERS
        WHERE user_id = #{userId}
    </select>
    
    <select id="selectUserByUsername" parameterType="String" resultType="UserVO">
        SELECT user_id, username, email, password, created_date, status
        FROM USERS
        WHERE username = #{username}
    </select>
    
    <!-- 3. ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ -->
    <select id="selectAllUsers" resultType="UserVO">
        SELECT user_id, username, email, password, created_date, status
        FROM USERS
        ORDER BY created_date DESC
    </select>
    
    <select id="selectUsersByStatus" parameterType="String" resultType="UserVO">
        SELECT user_id, username, email, password, created_date, status
        FROM USERS
        WHERE status = #{status}
        ORDER BY created_date DESC
    </select>
    
    <!-- 4. ì‚¬ìš©ì ìˆ˜ì • -->
    <update id="updateUser" parameterType="UserVO">
        UPDATE USERS SET
            username = #{username},
            email = #{email}
        WHERE user_id = #{userId}
    </update>
    
    <update id="updateUserStatus" parameterType="Map">
        UPDATE USERS SET
            status = #{status}
        WHERE user_id = #{userId}
    </update>
    
    <!-- 5. ì‚¬ìš©ì ì‚­ì œ -->
    <delete id="deleteUser" parameterType="Long">
        DELETE FROM USERS
        WHERE user_id = #{userId}
    </delete>
    
    <!-- 6. ì‚¬ìš©ì ìˆ˜ ì¡°íšŒ -->
    <select id="countUsers" resultType="int">
        SELECT COUNT(*) FROM USERS
    </select>
    
    <select id="countUsersByStatus" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM USERS
        WHERE status = #{status}
    </select>
    
    <!-- 7. í˜ì´ì§• ì¡°íšŒ -->
    <select id="selectUsersWithPaging" parameterType="Map" resultType="UserVO">
        SELECT * FROM (
            SELECT ROWNUM rn, a.* FROM (
                SELECT user_id, username, email, created_date, status
                FROM USERS
                WHERE 1=1
                <if test="status != null and status != ''">
                    AND status = #{status}
                </if>
                <if test="username != null and username != ''">
                    AND username LIKE '%' || #{username} || '%'
                </if>
                ORDER BY created_date DESC
            ) a
            WHERE ROWNUM &lt;= #{endRow}
        )
        WHERE rn > #{startRow}
    </select>

</mapper>
```

---

## ğŸ”§ MyBatis XML ë¬¸ë²• ì™„ì „ì •ë¦¬

### ğŸ“Œ ê¸°ë³¸ íƒœê·¸ë“¤

| íƒœê·¸        | ìš©ë„      | ì˜ˆì‹œ                                      |
| --------- | ------- | --------------------------------------- |
| `<select>`  | ì¡°íšŒ      | `<select id="getUser" resultType="User">` |
| `<insert>`  | ì‚½ì…      | `<insert id="insertUser" parameterType="User">` |
| `<update>`  | ìˆ˜ì •      | `<update id="updateUser">` |
| `<delete>`  | ì‚­ì œ      | `<delete id="deleteUser">` |

### ğŸ“Œ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

```xml
<!-- 1. ë‹¨ì¼ íŒŒë¼ë¯¸í„° -->
<select id="getUser" parameterType="Long" resultType="UserVO">
    SELECT * FROM USERS WHERE user_id = #{userId}
</select>

<!-- 2. ê°ì²´ íŒŒë¼ë¯¸í„° -->
<insert id="insertUser" parameterType="UserVO">
    INSERT INTO USERS (username, email, password)
    VALUES (#{username}, #{email}, #{password})
</insert>

<!-- 3. Map íŒŒë¼ë¯¸í„° -->
<select id="searchUsers" parameterType="Map" resultType="UserVO">
    SELECT * FROM USERS 
    WHERE username LIKE #{username}
    AND status = #{status}
</select>

<!-- 4. ì—¬ëŸ¬ íŒŒë¼ë¯¸í„° (@Param ì‚¬ìš©) -->
<select id="getUsersByRange" resultType="UserVO">
    SELECT * FROM USERS 
    WHERE user_id BETWEEN #{startId} AND #{endId}
</select>
```

### ğŸ“Œ ë™ì  SQL

```xml
<select id="searchUsersWithConditions" parameterType="Map" resultType="UserVO">
    SELECT * FROM USERS
    WHERE 1=1
    
    <!-- if: ì¡°ê±´ë¶€ SQL -->
    <if test="username != null and username != ''">
        AND username LIKE '%' || #{username} || '%'
    </if>
    
    <if test="status != null and status != ''">
        AND status = #{status}
    </if>
    
    <if test="fromDate != null">
        AND created_date >= #{fromDate}
    </if>
    
    <if test="toDate != null">
        AND created_date &lt;= #{toDate}
    </if>
    
    ORDER BY created_date DESC
</select>

<!-- choose-when-otherwise: switch-case ê°™ì€ ê¸°ëŠ¥ -->
<select id="getUsersByType" parameterType="String" resultType="UserVO">
    SELECT * FROM USERS
    WHERE 1=1
    <choose>
        <when test="type == 'active'">
            AND status = 'ACTIVE'
        </when>
        <when test="type == 'inactive'">
            AND status = 'INACTIVE'
        </when>
        <otherwise>
            AND status IN ('ACTIVE', 'INACTIVE')
        </otherwise>
    </choose>
</select>

<!-- where: ë™ì  WHERE ì ˆ -->
<select id="searchUsers" parameterType="Map" resultType="UserVO">
    SELECT * FROM USERS
    <where>
        <if test="username != null">
            username LIKE #{username}
        </if>
        <if test="email != null">
            AND email LIKE #{email}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
    </where>
</select>

<!-- set: ë™ì  UPDATE ì ˆ -->
<update id="updateUserSelective" parameterType="UserVO">
    UPDATE USERS
    <set>
        <if test="username != null">username = #{username},</if>
        <if test="email != null">email = #{email},</if>
        <if test="status != null">status = #{status},</if>
    </set>
    WHERE user_id = #{userId}
</update>

<!-- foreach: ë°˜ë³µ ì²˜ë¦¬ -->
<select id="getUsersByIds" parameterType="List" resultType="UserVO">
    SELECT * FROM USERS
    WHERE user_id IN
    <foreach collection="list" item="id" open="(" separator="," close=")">
        #{id}
    </foreach>
</select>

<insert id="insertUsers" parameterType="List">
    INSERT INTO USERS (username, email, password) VALUES
    <foreach collection="list" item="user" separator=",">
        (#{user.username}, #{user.email}, #{user.password})
    </foreach>
</insert>
```

---

## ğŸ” SQL ë¡œê·¸ ë³´ê¸°

### ğŸ“Œ log4jdbc ì„¤ì •

**1ë‹¨ê³„: ì˜ì¡´ì„± ì¶”ê°€**

```xml
<dependency>
    <groupId>org.bgee.log4jdbc-log4j2</groupId>
    <artifactId>log4jdbc-log4j2-jdbc4.1</artifactId>
    <version>1.16</version>
</dependency>
```

**2ë‹¨ê³„: ë¡œê·¸ ì„¤ì • íŒŒì¼ (log4jdbc.log4j2.properties)**

```properties
# src/main/resources/log4jdbc.log4j2.properties
log4jdbc.spylogdelegator.name=net.sf.log4jdbc.log.slf4j.Slf4jSpyLogDelegator
log4jdbc.dump.sql.maxlinelength=0
```

**3ë‹¨ê³„: DataSource ì„¤ì • ë³€ê²½**

```xml
<bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
    <!-- ê¸°ì¡´ ì„¤ì •
    <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver" />
    <property name="jdbcUrl" value="jdbc:oracle:thin:@127.0.0.1:1521:xe" />
    -->
    
    <!-- log4jdbc ì ìš© -->
    <property name="driverClassName" value="net.sf.log4jdbc.sql.jdbcapi.DriverSpy" />
    <property name="jdbcUrl" value="jdbc:log4jdbc:oracle:thin:@127.0.0.1:1521:xe" />
    <property name="username" value="hr" />
    <property name="password" value="hr" />
</bean>
```

**4ë‹¨ê³„: ë¡œê·¸ ë ˆë²¨ ì„¤ì • (logback.xml)**

```xml
<configuration>
    <!-- ë£¨íŠ¸ ë¡œê±° -->
    <root level="ERROR">
        <appender-ref ref="STDOUT" />
    </root>
    
    <!-- JDBC ë¡œê·¸ ì„¤ì • -->
    <logger name="jdbc.sqlonly" level="INFO" />
    <logger name="jdbc.sqltiming" level="DEBUG" />
    <logger name="jdbc.resultsettable" level="INFO" />
    <logger name="jdbc.resultset" level="ERROR" />
    <logger name="jdbc.connection" level="ERROR" />
    <logger name="jdbc.audit" level="ERROR" />
    
    <!-- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ -->
    <logger name="com.example" level="DEBUG" />
</configuration>
```

### ğŸ“Œ ë¡œê·¸ ì¢…ë¥˜ë³„ ì„¤ëª…

| ë¡œê±°ëª…                    | ì„¤ëª…                              |
| ---------------------- | ------------------------------- |
| `jdbc.sqlonly`         | **SQLë¬¸ë§Œ** ë¡œê·¸ë¡œ ë‚¨ê¹€ (íŒŒë¼ë¯¸í„° ê°’ í¬í•¨)   |
| `jdbc.sqltiming`       | **SQLë¬¸ + ì‹¤í–‰ì‹œê°„** ì •ë³´ í¬í•¨          |
| `jdbc.resultsettable`  | **SQL ê²°ê³¼ë¥¼ í…Œì´ë¸” í˜•íƒœ**ë¡œ ë¡œê·¸ì— ì¶œë ¥     |
| `jdbc.resultset`       | **ResultSet ìƒì„¸ ì •ë³´** (ë§ì€ ë¡œê·¸ ìƒì„±)  |
| `jdbc.connection`      | **ì—°ê²° ìˆ˜ë¦½/í•´ì œ** ì´ë²¤íŠ¸ ê¸°ë¡            |
| `jdbc.audit`           | **ëª¨ë“  JDBC í˜¸ì¶œ** ì •ë³´ (ë§¤ìš° ìƒì„¸í•¨)     |

### ğŸ“Œ ì‹¤ì œ ë¡œê·¸ ì¶œë ¥ ì˜ˆì‹œ

```text
INFO : jdbc.sqlonly - SELECT employee_id, first_name, last_name, email, hire_date, job_id, salary FROM employees WHERE employee_id = '101'

DEBUG: jdbc.sqltiming - 
org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:62)
1. SELECT employee_id, first_name, last_name, email, hire_date, job_id, salary FROM employees WHERE employee_id = '101' {executed in 18 msec}

INFO : jdbc.resultsettable - 
|------------|------------|-----------|--------|----------|-------|--------|
|employee_id |first_name  |last_name  |email   |hire_date |job_id |salary  |
|------------|------------|-----------|--------|----------|-------|--------|
|101         |Neena       |Kochhar    |NKOCHHAR|2005-09-21|AD_VP  |17000   |
|------------|------------|-----------|--------|----------|-------|--------|
```

---

## ğŸ¯ Service ë ˆì´ì–´ êµ¬í˜„

### ğŸ“Œ UserService ì¸í„°í˜ì´ìŠ¤

```java
package com.example.service;

import com.example.vo.UserVO;
import java.util.List;

public interface UserService {
    
    // ì‚¬ìš©ì ë“±ë¡
    boolean registerUser(UserVO user);
    
    // ì‚¬ìš©ì ì¡°íšŒ
    UserVO getUser(Long userId);
    UserVO getUserByUsername(String username);
    
    // ì‚¬ìš©ì ëª©ë¡
    List<UserVO> getAllUsers();
    List<UserVO> getActiveUsers();
    
    // ì‚¬ìš©ì ìˆ˜ì •
    boolean updateUser(UserVO user);
    boolean updateUserStatus(Long userId, String status);
    
    // ì‚¬ìš©ì ì‚­ì œ
    boolean deleteUser(Long userId);
    
    // í˜ì´ì§• ì¡°íšŒ
    List<UserVO> getUsersWithPaging(int page, int size);
    int getTotalUserCount();
}
```

### ğŸ“Œ UserServiceImpl êµ¬í˜„

```java
package com.example.service.impl;

import com.example.mapper.UserMapper;
import com.example.service.UserService;
import com.example.vo.UserVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Service
@Transactional
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public boolean registerUser(UserVO user) {
        try {
            // ì¤‘ë³µ ì²´í¬
            UserVO existingUser = userMapper.selectUserByUsername(user.getUsername());
            if (existingUser != null) {
                throw new RuntimeException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤: " + user.getUsername());
            }
            
            int result = userMapper.insertUser(user);
            return result > 0;
        } catch (Exception e) {
            throw new RuntimeException("ì‚¬ìš©ì ë“±ë¡ ì‹¤íŒ¨: " + e.getMessage());
        }
    }
    
    @Override
    @Transactional(readOnly = true)
    public UserVO getUser(Long userId) {
        return userMapper.selectUser(userId);
    }
    
    @Override
    @Transactional(readOnly = true)
    public UserVO getUserByUsername(String username) {
        return userMapper.selectUserByUsername(username);
    }
    
    @Override
    @Transactional(readOnly = true)
    public List<UserVO> getAllUsers() {
        return userMapper.selectAllUsers();
    }
    
    @Override
    @Transactional(readOnly = true)
    public List<UserVO> getActiveUsers() {
        return userMapper.selectUsersByStatus("ACTIVE");
    }
    
    @Override
    public boolean updateUser(UserVO user) {
        try {
            int result = userMapper.updateUser(user);
            return result > 0;
        } catch (Exception e) {
            throw new RuntimeException("ì‚¬ìš©ì ìˆ˜ì • ì‹¤íŒ¨: " + e.getMessage());
        }
    }
    
    @Override
    public boolean updateUserStatus(Long userId, String status) {
        try {
            Map<String, Object> params = new HashMap<>();
            params.put("userId", userId);
            params.put("status", status);
            
            int result = userMapper.updateUserStatus(params);
            return result > 0;
        } catch (Exception e) {
            throw new RuntimeException("ì‚¬ìš©ì ìƒíƒœ ìˆ˜ì • ì‹¤íŒ¨: " + e.getMessage());
        }
    }
    
    @Override
    public boolean deleteUser(Long userId) {
        try {
            int result = userMapper.deleteUser(userId);
            return result > 0;
        } catch (Exception e) {
            throw new RuntimeException("ì‚¬ìš©ì ì‚­ì œ ì‹¤íŒ¨: " + e.getMessage());
        }
    }
    
    @Override
    @Transactional(readOnly = true)
    public List<UserVO> getUsersWithPaging(int page, int size) {
        int startRow = (page - 1) * size;
        int endRow = page * size;
        
        Map<String, Object> params = new HashMap<>();
        params.put("startRow", startRow);
        params.put("endRow", endRow);
        
        return userMapper.selectUsersWithPaging(params);
    }
    
    @Override
    @Transactional(readOnly = true)
    public int getTotalUserCount() {
        return userMapper.countUsers();
    }
}
```

---

## ğŸ® Controller ë ˆì´ì–´ êµ¬í˜„

### ğŸ“Œ UserController

```java
package com.example.controller;

import com.example.service.UserService;
import com.example.vo.UserVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import java.util.List;

@Controller
@RequestMapping("/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // ì‚¬ìš©ì ëª©ë¡ í˜ì´ì§€
    @GetMapping("/list")
    public String userList(Model model) {
        List<UserVO> users = userService.getAllUsers();
        model.addAttribute("users", users);
        return "user/list";
    }
    
    // ì‚¬ìš©ì ë“±ë¡ í¼
    @GetMapping("/register")
    public String registerForm(Model model) {
        model.addAttribute("user", new UserVO());
        return "user/register";
    }
    
    // ì‚¬ìš©ì ë“±ë¡ ì²˜ë¦¬
    @PostMapping("/register")
    public String registerUser(@ModelAttribute UserVO user, 
                             RedirectAttributes redirectAttributes) {
        try {
            boolean success = userService.registerUser(user);
            if (success) {
                redirectAttributes.addFlashAttribute("message", "ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                redirectAttributes.addFlashAttribute("error", "ì‚¬ìš©ì ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", e.getMessage());
        }
        
        return "redirect:/users/list";
    }
    
    // ì‚¬ìš©ì ìƒì„¸ ì¡°íšŒ
    @GetMapping("/{userId}")
    public String userDetail(@PathVariable Long userId, Model model) {
        UserVO user = userService.getUser(userId);
        if (user == null) {
            model.addAttribute("error", "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return "error/404";
        }
        
        model.addAttribute("user", user);
        return "user/detail";
    }
    
    // ì‚¬ìš©ì ìˆ˜ì • í¼
    @GetMapping("/{userId}/edit")
    public String editForm(@PathVariable Long userId, Model model) {
        UserVO user = userService.getUser(userId);
        if (user == null) {
            model.addAttribute("error", "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return "error/404";
        }
        
        model.addAttribute("user", user);
        return "user/edit";
    }
    
    // ì‚¬ìš©ì ìˆ˜ì • ì²˜ë¦¬
    @PostMapping("/{userId}/edit")
    public String updateUser(@PathVariable Long userId, 
                           @ModelAttribute UserVO user,
                           RedirectAttributes redirectAttributes) {
        try {
            user.setUserId(userId);
            boolean success = userService.updateUser(user);
            if (success) {
                redirectAttributes.addFlashAttribute("message", "ì‚¬ìš©ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                redirectAttributes.addFlashAttribute("error", "ì‚¬ìš©ì ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", e.getMessage());
        }
        
        return "redirect:/users/" + userId;
    }
    
    // ì‚¬ìš©ì ì‚­ì œ
    @PostMapping("/{userId}/delete")
    public String deleteUser(@PathVariable Long userId, 
                           RedirectAttributes redirectAttributes) {
        try {
            boolean success = userService.deleteUser(userId);
            if (success) {
                redirectAttributes.addFlashAttribute("message", "ì‚¬ìš©ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                redirectAttributes.addFlashAttribute("error", "ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", e.getMessage());
        }
        
        return "redirect:/users/list";
    }
}
```

### ğŸ“Œ REST API Controller

```java
package com.example.controller;

import com.example.service.UserService;
import com.example.vo.UserVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/users")
public class UserApiController {
    
    @Autowired
    private UserService userService;
    
    // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
    @GetMapping
    public ResponseEntity<List<UserVO>> getAllUsers() {
        List<UserVO> users = userService.getAllUsers();
        return ResponseEntity.ok(users);
    }
    
    // ì‚¬ìš©ì ìƒì„¸ ì¡°íšŒ
    @GetMapping("/{userId}")
    public ResponseEntity<UserVO> getUser(@PathVariable Long userId) {
        UserVO user = userService.getUser(userId);
        if (user == null) {
            return ResponseEntity.notFound().build();
        }
        return ResponseEntity.ok(user);
    }
    
    // ì‚¬ìš©ì ë“±ë¡
    @PostMapping
    public ResponseEntity<String> createUser(@RequestBody UserVO user) {
        try {
            boolean success = userService.registerUser(user);
            if (success) {
                return ResponseEntity.status(HttpStatus.CREATED)
                                   .body("ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                return ResponseEntity.badRequest()
                                   .body("ì‚¬ìš©ì ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
    
    // ì‚¬ìš©ì ìˆ˜ì •
    @PutMapping("/{userId}")
    public ResponseEntity<String> updateUser(@PathVariable Long userId, 
                                           @RequestBody UserVO user) {
        try {
            user.setUserId(userId);
            boolean success = userService.updateUser(user);
            if (success) {
                return ResponseEntity.ok("ì‚¬ìš©ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                return ResponseEntity.badRequest()
                                   .body("ì‚¬ìš©ì ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
    
    // ì‚¬ìš©ì ì‚­ì œ
    @DeleteMapping("/{userId}")
    public ResponseEntity<String> deleteUser(@PathVariable Long userId) {
        try {
            boolean success = userService.deleteUser(userId);
            if (success) {
                return ResponseEntity.ok("ì‚¬ìš©ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                return ResponseEntity.badRequest()
                                   .body("ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
    
    // í˜ì´ì§• ì¡°íšŒ
    @GetMapping("/page/{page}")
    public ResponseEntity<List<UserVO>> getUsersWithPaging(@PathVariable int page,
                                                         @RequestParam(defaultValue = "10") int size) {
        List<UserVO> users = userService.getUsersWithPaging(page, size);
        return ResponseEntity.ok(users);
    }
}
```

---

## ğŸš€ ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œì˜ MyBatis ì„¤ì •

### ğŸ“Œ application.properties ì„¤ì •

```properties
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •
spring.datasource.driver-class-name=oracle.jdbc.driver.OracleDriver
spring.datasource.url=jdbc:oracle:thin:@localhost:1521:xe
spring.datasource.username=hr
spring.datasource.password=hr

# HikariCP ì„¤ì •
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000

# MyBatis ì„¤ì •
mybatis.mapper-locations=classpath:mapper/**/*.xml
mybatis.type-aliases-package=com.example.vo
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.default-fetch-size=100
mybatis.configuration.default-statement-timeout=30

# SQL ë¡œê·¸ ì„¤ì • (log4jdbc ì‚¬ìš© ì‹œ)
spring.datasource.driver-class-name=net.sf.log4jdbc.sql.jdbcapi.DriverSpy
spring.datasource.url=jdbc:log4jdbc:oracle:thin:@localhost:1521:xe

# ë¡œê·¸ ë ˆë²¨ ì„¤ì •
logging.level.jdbc.sqlonly=INFO
logging.level.jdbc.sqltiming=DEBUG
logging.level.jdbc.resultsettable=INFO
logging.level.com.example.mapper=DEBUG
```

### ğŸ“Œ ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ì¸ í´ë˜ìŠ¤

```java
package com.example;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@MapperScan("com.example.mapper")  // Mapper ì¸í„°í˜ì´ìŠ¤ ìŠ¤ìº”
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

---

## âš ï¸ MyBatis ì‚¬ìš© ì‹œ ì£¼ì˜ì 

### ğŸ§± 1. SQL Injection ë°©ì§€

```xml
<!-- âŒ ìœ„í—˜í•œ ë°©ë²•: ${} ì‚¬ìš© -->
<select id="badExample" parameterType="String" resultType="UserVO">
    SELECT * FROM USERS WHERE username = '${username}'
    <!-- ì‚¬ìš©ìê°€ '; DROP TABLE USERS; -- ì…ë ¥í•˜ë©´ ìœ„í—˜! -->
</select>

<!-- âœ… ì•ˆì „í•œ ë°©ë²•: #{} ì‚¬ìš© -->
<select id="goodExample" parameterType="String" resultType="UserVO">
    SELECT * FROM USERS WHERE username = #{username}
    <!-- PreparedStatementë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë¨ -->
</select>

<!-- âœ… ë™ì  ORDER BYëŠ” ì˜ˆì™¸ì ìœ¼ë¡œ ${} ì‚¬ìš© (ê²€ì¦ í•„ìˆ˜) -->
<select id="getUsersWithOrder" parameterType="Map" resultType="UserVO">
    SELECT * FROM USERS
    <if test="orderBy != null">
        ORDER BY ${orderBy}  <!-- ë°˜ë“œì‹œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì¦ í•„ìš” -->
    </if>
</select>
```

### ğŸ’¾ 2. resultType vs resultMap

```xml
<!-- ê°„ë‹¨í•œ ê²½ìš°: resultType ì‚¬ìš© -->
<select id="getUser" resultType="UserVO">
    SELECT user_id, username, email FROM USERS WHERE user_id = #{userId}
</select>

<!-- ë³µì¡í•œ ë§¤í•‘: resultMap ì‚¬ìš© -->
<resultMap id="userDetailMap" type="UserVO">
    <id property="userId" column="user_id" />
    <result property="username" column="user_name" />
    <result property="email" column="email_addr" />
    <result property="createdDate" column="reg_date" />
</resultMap>

<select id="getUserDetail" resultMap="userDetailMap">
    SELECT user_id, user_name, email_addr, reg_date
    FROM USERS WHERE user_id = #{userId}
</select>
```

### ğŸ› ï¸ 3. íŠ¸ëœì­ì…˜ ê´€ë¦¬

```java
@Service
@Transactional  // í´ë˜ìŠ¤ ë ˆë²¨ì— ì ìš©
public class UserService {
    
    @Transactional(readOnly = true)  // ì½ê¸° ì „ìš©
    public UserVO getUser(Long userId) {
        return userMapper.selectUser(userId);
    }
    
    @Transactional(rollbackFor = Exception.class)  // ëª¨ë“  ì˜ˆì™¸ì— ëŒ€í•´ ë¡¤ë°±
    public void registerUserWithProfile(UserVO user, ProfileVO profile) {
        userMapper.insertUser(user);
        profileMapper.insertProfile(profile);  // ë‘˜ ë‹¤ ì„±ê³µí•´ì•¼ ì»¤ë°‹
    }
    
    @Transactional(propagation = Propagation.REQUIRES_NEW)  // ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜
    public void auditLog(String action) {
        auditMapper.insertLog(action);  // ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜
    }
}
```

### ğŸ”§ 4. ì„±ëŠ¥ ìµœì í™”

```xml
<!-- 1. í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¡°íšŒ -->
<select id="getUserListForDisplay" resultType="UserVO">
    SELECT user_id, username, email  <!-- password, created_date ì œì™¸ -->
    FROM USERS
    ORDER BY username
</select>

<!-- 2. í˜ì´ì§• ì¿¼ë¦¬ ìµœì í™” -->
<select id="getUsersWithPaging" parameterType="Map" resultType="UserVO">
    SELECT * FROM (
        SELECT /*+ FIRST_ROWS(#{pageSize}) */ 
               ROWNUM rn, a.* 
        FROM (
            SELECT user_id, username, email
            FROM USERS
            ORDER BY user_id
        ) a
        WHERE ROWNUM &lt;= #{endRow}
    )
    WHERE rn > #{startRow}
</select>

<!-- 3. ë°°ì¹˜ ì²˜ë¦¬ -->
<insert id="insertUsersBatch" parameterType="List">
    INSERT INTO USERS (user_id, username, email)
    <foreach collection="list" item="user" separator=" UNION ALL ">
        SELECT #{user.userId}, #{user.username}, #{user.email} FROM DUAL
    </foreach>
</insert>
```

---

## âœ… MyBatis vs JPA ë¹„êµ

| êµ¬ë¶„       | **MyBatis**           | **JPA**                    |
| -------- | --------------------- | -------------------------- |
| **SQL ì œì–´** | **ì§ì ‘ SQL ì‘ì„±** (ì™„ì „í•œ ì œì–´) | **ìë™ SQL ìƒì„±** (ê°„í¸í•¨)        |
| **í•™ìŠµ ê³¡ì„ ** | **ìƒëŒ€ì ìœ¼ë¡œ ì‰¬ì›€** (SQL ì§€ì‹ í•„ìš”) | **ì–´ë ¤ì›€** (ORM ê°œë… ì´í•´ í•„ìš”)     |
| **ì„±ëŠ¥**   | **ìµœì í™”ëœ SQL** ê°€ëŠ¥       | **N+1 ë¬¸ì œ** ë“± ì£¼ì˜ í•„ìš”        |
| **ìœ ì§€ë³´ìˆ˜** | SQL ë³€ê²½ ì‹œ **XML ìˆ˜ì •** í•„ìš”  | **ì—”í‹°í‹° ë³€ê²½**ìœ¼ë¡œ ìë™ ë°˜ì˜        |
| **ë°ì´í„°ë² ì´ìŠ¤** | **íŠ¹ì • DBì— ì¢…ì†** ê°€ëŠ¥      | **DB ë…ë¦½ì ** ê°œë°œ ê°€ëŠ¥          |
| **ë³µì¡í•œ ì¿¼ë¦¬** | **ììœ ë¡­ê²Œ ì‘ì„±** ê°€ëŠ¥        | **ì–´ë ¤ì›€** (ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ í•„ìš”)      |

### ğŸ¯ ì„ íƒ ê¸°ì¤€

**MyBatisë¥¼ ì„ íƒí•˜ëŠ” ê²½ìš°:**
- **ë³µì¡í•œ SQLì´ ë§ì€ í”„ë¡œì íŠ¸**
- **ê¸°ì¡´ ë ˆê±°ì‹œ DBì™€ ì—°ë™**
- **SQL ìµœì í™”ê°€ ì¤‘ìš”í•œ ê²½ìš°**
- **ê°œë°œìê°€ SQLì— ìµìˆ™í•œ ê²½ìš°**

**JPAë¥¼ ì„ íƒí•˜ëŠ” ê²½ìš°:**
- **ë‹¨ìˆœí•œ CRUD ìœ„ì£¼ì˜ í”„ë¡œì íŠ¸**
- **ê°ì²´ ì§€í–¥ì  ê°œë°œì„ ì›í•˜ëŠ” ê²½ìš°**
- **DB ë…ë¦½ì ì¸ ê°œë°œì´ í•„ìš”í•œ ê²½ìš°**
- **ë¹ ë¥¸ ê°œë°œì´ ìš°ì„ ì¸ ê²½ìš°**

---

## ğŸ“š MyBatis í•µì‹¬ ìš”ì•½

| ê°œë…               | ì„¤ëª…                           |
| ---------------- | ---------------------------- |
| **SqlSessionFactory** | MyBatisì˜ í•µì‹¬ íŒ©í† ë¦¬ í´ë˜ìŠ¤           |
| **SqlSession**     | ì‹¤ì œ SQLì„ ì‹¤í–‰í•˜ëŠ” ì„¸ì…˜ ê°ì²´          |
| **Mapper Interface** | SQL ì‹¤í–‰ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤            |
| **Mapper XML**     | SQL ì¿¼ë¦¬ì™€ ë§¤í•‘ ì •ë³´ë¥¼ ë‹´ì€ íŒŒì¼        |
| **#{} ë¬¸ë²•**        | PreparedStatement íŒŒë¼ë¯¸í„° ë°”ì¸ë”©   |
| **${} ë¬¸ë²•**        | ë¬¸ìì—´ ì¹˜í™˜ (SQL Injection ì£¼ì˜)   |
| **ë™ì  SQL**        | if, choose, foreach ë“±ìœ¼ë¡œ ì¡°ê±´ë¶€ SQL |

---

## ğŸ§  MyBatis ê°œë°œ íë¦„

```text
1. ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì„¤ê³„
   â†“
2. VO(Value Object) í´ë˜ìŠ¤ ìƒì„±
   â†“
3. Mapper ì¸í„°í˜ì´ìŠ¤ ì‘ì„±
   â†“
4. Mapper XML ì‘ì„± (SQL ì •ì˜)
   â†“
5. Service ë ˆì´ì–´ êµ¬í˜„
   â†“
6. Controller ë ˆì´ì–´ êµ¬í˜„
   â†“
7. í…ŒìŠ¤íŠ¸ ë° SQL ë¡œê·¸ í™•ì¸
```

---

## ğŸ¯ ì‹¤ì „ í”„ë¡œì íŠ¸ ì˜ˆì‹œ

### ğŸ“Œ ê²Œì‹œíŒ ì‹œìŠ¤í…œ

```java
// BoardMapper.xml
<mapper namespace="com.example.mapper.BoardMapper">
    
    <!-- ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§• + ê²€ìƒ‰) -->
    <select id="selectBoardList" parameterType="Map" resultType="BoardVO">
        SELECT * FROM (
            SELECT ROWNUM rn, a.* FROM (
                SELECT board_id, title, content, author, created_date, view_count
                FROM BOARD
                WHERE 1=1
                <if test="searchType != null and searchKeyword != null">
                    <choose>
                        <when test="searchType == 'title'">
                            AND title LIKE '%' || #{searchKeyword} || '%'
                        </when>
                        <when test="searchType == 'content'">
                            AND content LIKE '%' || #{searchKeyword} || '%'
                        </when>
                        <when test="searchType == 'author'">
                            AND author LIKE '%' || #{searchKeyword} || '%'
                        </when>
                    </choose>
                </if>
                ORDER BY created_date DESC
            ) a
            WHERE ROWNUM &lt;= #{endRow}
        )
        WHERE rn > #{startRow}
    </select>
    
    <!-- ì¡°íšŒìˆ˜ ì¦ê°€ -->
    <update id="increaseViewCount" parameterType="Long">
        UPDATE BOARD SET view_count = view_count + 1
        WHERE board_id = #{boardId}
    </update>
    
</mapper>
```

---

## ğŸ“š ì°¸ê³ ìë£Œ

* ã€MyBatis ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ã€ ê°•ì˜ ìë£Œ
* MyBatis ê³µì‹ ë¬¸ì„œ
* ìŠ¤í”„ë§ ë¶€íŠ¸ + MyBatis ì—°ë™ ê°€ì´ë“œ
* SQL ìµœì í™” ë° ì„±ëŠ¥ íŠœë‹ ê°€ì´ë“œ

> ì´ ê¸€ì€ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ **MyBatisë¥¼ í™œìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ë°©ë²•ì„ ëª…í™•í•˜ê²Œ ì „ë‹¬**í•˜ê¸° ìœ„í•´
> ê°•ì˜ ìë£Œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ëœ í•™ìŠµ ìë£Œì…ë‹ˆë‹¤. ğŸ˜Š