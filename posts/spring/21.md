# ğŸŸ¡ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ - (3) AOP

## âœ… AOP(Aspect-Oriented Programming)ë€?

> **ê´€ì ì§€í–¥ í”„ë¡œê·¸ë˜ë°**! ê¸°ì¡´ ì½”ë“œì— **ì „í˜€ ì˜í–¥ ì—†ì´** ë©”ì„œë“œì˜ **í˜¸ì¶œ ì´ì „ í˜¹ì€ ì´í›„ì— í•„ìš”í•œ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•**ì„ ì œê³µ!
> **auto-proxy(weaving)** ê¸°ë²•ìœ¼ë¡œ **íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬**í•˜ëŠ” ë§ˆë²•! âœ¨

---

## ğŸ“Œ ê´€ì‹¬ë¶„ë¦¬ (Separation Of Concerns)

> **AOPëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œì˜ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬**(ê¸°ëŠ¥ì˜ ë¶„ë¦¬) ì¦‰, **í•µì‹¬ì ì¸ ê¸°ëŠ¥ê³¼ ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ë¶„ë¦¬í•œë‹¤**

### ğŸ¯ í•µì‹¬ê¸°ëŠ¥ê³¼ ë¶€ê°€ê¸°ëŠ¥

| ê´€ì‹¬ì‚¬ ì¢…ë¥˜     | ì„¤ëª…                           | ì˜ˆì‹œ                     |
| ---------- | ---------------------------- | ---------------------- |
| **í•µì‹¬ ê´€ì‹¬**  | **ì—…ë¬´ ë¡œì§ì„ í¬í•¨í•˜ëŠ” ê¸°ëŠ¥**           | ìƒí’ˆ ë“±ë¡, ì£¼ë¬¸ ì²˜ë¦¬, íšŒì› ê´€ë¦¬    |
| **íš¡ë‹¨ ê´€ì‹¬**  | **í•µì‹¬ê¸°ëŠ¥ì„ ë„ì™€ì£¼ëŠ” ë¶€ê°€ì ì¸ ê¸°ëŠ¥**       | ë¡œê¹…, ë³´ì•ˆ, íŠ¸ëœì­ì…˜, ì˜ˆì™¸ ì²˜ë¦¬    |

### ğŸ“Š íš¡ë‹¨ ê´€ì‹¬ì‚¬ì˜ ë¬¸ì œì 

**âŒ AOP ì ìš© ì „ - ì½”ë“œ ì¤‘ë³µì˜ ì§€ì˜¥**

```java
public class UserService {
    public void registerUser(User user) {
        System.out.println("ë¡œê·¸: ì‚¬ìš©ì ë“±ë¡ ì‹œì‘");  // ë¡œê¹… ì½”ë“œ ì¤‘ë³µ
        
        // ë³´ì•ˆ ì²´í¬ ì½”ë“œ ì¤‘ë³µ
        if (!checkSecurity()) {
            throw new SecurityException();
        }
        
        // í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        userRepository.save(user);
        
        System.out.println("ë¡œê·¸: ì‚¬ìš©ì ë“±ë¡ ì™„ë£Œ");  // ë¡œê¹… ì½”ë“œ ì¤‘ë³µ
    }
    
    public void deleteUser(Long id) {
        System.out.println("ë¡œê·¸: ì‚¬ìš©ì ì‚­ì œ ì‹œì‘");  // ë˜ ì¤‘ë³µ!
        
        // ë³´ì•ˆ ì²´í¬ ì½”ë“œ ë˜ ì¤‘ë³µ!
        if (!checkSecurity()) {
            throw new SecurityException();
        }
        
        // í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        userRepository.deleteById(id);
        
        System.out.println("ë¡œê·¸: ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ");  // ë˜ ì¤‘ë³µ!
    }
}
```

**âœ… AOP ì ìš© í›„ - ê¹”ë”í•œ ë¶„ë¦¬**

```java
// í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë‚¨ìŒ!
public class UserService {
    public void registerUser(User user) {
        userRepository.save(user);  // ì˜¤ì§ í•µì‹¬ ë¡œì§ë§Œ!
    }
    
    public void deleteUser(Long id) {
        userRepository.deleteById(id);  // ì˜¤ì§ í•µì‹¬ ë¡œì§ë§Œ!
    }
}

// íš¡ë‹¨ ê´€ì‹¬ì‚¬ëŠ” ë³„ë„ ë¶„ë¦¬
@Aspect
@Component
public class LoggingAspect {
    @Before("execution(* *.UserService.*(..))")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("ë¡œê·¸: " + joinPoint.getSignature().getName() + " ì‹œì‘");
    }
    
    @After("execution(* *.UserService.*(..))")
    public void logAfter(JoinPoint joinPoint) {
        System.out.println("ë¡œê·¸: " + joinPoint.getSignature().getName() + " ì™„ë£Œ");
    }
}
```

---

## ğŸ”§ AOP í•µì‹¬ ìš©ì–´ ì™„ì „ì •ë³µ

### ğŸ“Œ ì£¼ìš” ìš©ì–´ ì •ë¦¬

| ìš©ì–´                 | ì„¤ëª…                                  | ì‰¬ìš´ ì˜ˆì‹œ                         |
| ------------------ | ----------------------------------- | ---------------------------- |
| **Advice**         | **íš¡ë‹¨ ê´€ì‹¬ì— í•´ë‹¹í•˜ëŠ” ê³µí†µê¸°ëŠ¥ì˜ ì½”ë“œ**            | ë¡œê¹… ë©”ì†Œë“œ, ë³´ì•ˆ ì²´í¬ ë©”ì†Œë“œ          |
| **Aspect (Advisor)** | **ê³µí†µìœ¼ë¡œ ì‹¤í–‰ë  ë¡œì§(ì–´ë“œë°”ì´ìŠ¤)ì˜ ëª¨ìŒ**         | LoggingAspect, SecurityAspect |
| **JoinPoint**      | **í´ë¼ì´ì–¸íŠ¸ê°€ í˜¸ì¶œí•˜ëŠ” ëª¨ë“  ì„œë¹„ìŠ¤(ë¹„ì¦ˆë‹ˆìŠ¤) ë©”ì†Œë“œ**   | registerUser(), getUser()  |
| **Pointcut**       | **Adviceë¥¼ ì–´ë–¤ Join Pointì— ê²°í•©í•  ê²ƒì¸ì§€ ê²°ì •** | `execution(* *.get*(..))` |
| **Weaving**        | **Adviceë¥¼ í•µì‹¬ë¡œì§ì— ì ìš©í•˜ëŠ” ê³¼ì •**           | ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ í”„ë¡ì‹œ ìƒì„±         |

### ğŸ¯ AOP ì ìš© ê³¼ì • ì‹œê°í™”

```text
1. PointCut ì„¤ì • 
   â†“ (ì–´ë–¤ ë©”ì†Œë“œì— ì ìš©í• ì§€ ê²°ì •)
2. Aspect í´ë˜ìŠ¤ ìƒì„±
   â†“ (ê³µí†µ ë¡œì§ì„ ë‹´ì€ í´ë˜ìŠ¤)
3. Advice ë©”ì†Œë“œ ì‘ì„± 
   â†“ (ì‹¤ì œ ì‹¤í–‰ë  ë¶€ê°€ ê¸°ëŠ¥)
4. JoinPointì—ì„œ ì‹¤í–‰
   â†“ (ë©”ì†Œë“œ í˜¸ì¶œ ì‹œ ìë™ ì‹¤í–‰)
5. Weaving (ìœ„ë¹™)
   â†“ (ìŠ¤í”„ë§ì´ í”„ë¡ì‹œ ê°ì²´ ìƒì„±)
6. í´ë¼ì´ì–¸íŠ¸ëŠ” í”„ë¡ì‹œë¥¼ í†µí•´ í˜¸ì¶œ
```

---

## ğŸ”· Advice ì¢…ë¥˜ë³„ ì™„ì „ë¶„ì„

> **ë¶€ê°€ê´€ì‹¬(ë¡œì§)ì„ ë³„ë„ë¡œ ë¶„ë¦¬í•œ ì½”ë“œ**
> **ë™ì‘ìœ„ì¹˜ì— ë”°ë¼ êµ¬ë¶„**ë¨!

### ğŸ“Œ Advice íƒ€ì…ë³„ ìƒì„¸ ì •ë¦¬

| Advice ì¢…ë¥˜            | ì‹¤í–‰ ì‹œì                       | ì„¤ëª…                        | ì–´ë…¸í…Œì´ì…˜      | ì‚¬ìš© ì‚¬ë¡€           |
| -------------------- | -------------------------- | ------------------------- | ---------- | --------------- |
| **Before**           | ë©”ì†Œë“œ **ì‹¤í–‰ ì „**               | ì‚¬ì „ ê²€ì¦, ë¡œê¹… ì‹œì‘              | `@Before`    | ë³´ì•ˆ ì²´í¬, íŒŒë¼ë¯¸í„° ê²€ì¦   |
| **After**            | ë©”ì†Œë“œ **ì‹¤í–‰ í›„** (ì˜ˆì™¸ ë°œìƒê³¼ ë¬´ê´€)   | ë¦¬ì†ŒìŠ¤ ì •ë¦¬, ë¡œê¹… ì¢…ë£Œ            | `@After`     | ì •ë¦¬ ì‘ì—…, ë¡œê·¸ ê¸°ë¡     |
| **After-Returning**  | ë©”ì†Œë“œ **ì •ìƒ ì‹¤í–‰ í›„** ë¦¬í„´ ì‹œì      | ì„±ê³µ ë¡œê¹…, ê²°ê³¼ê°’ ê²€ì¦            | `@AfterReturning` | ì„±ê³µ ì•Œë¦¼, ê²°ê³¼ê°’ ë¡œê¹…   |
| **After-Throwing**   | ë©”ì†Œë“œ **ì‹¤í–‰ ì¤‘ ì˜ˆì™¸ ë°œìƒ** ì‹œì      | ì˜ˆì™¸ ë¡œê¹…, ì•Œë¦¼ ë°œì†¡             | `@AfterThrowing` | ì—ëŸ¬ ì•Œë¦¼, ì˜ˆì™¸ ë¡œê¹…    |
| **Around**           | ë©”ì†Œë“œ **ì‹¤í–‰ ì „ê³¼ í›„** ëª¨ë‘        | ì„±ëŠ¥ ì¸¡ì •, íŠ¸ëœì­ì…˜ ê´€ë¦¬           | `@Around`    | ì„±ëŠ¥ ì¸¡ì •, ìºì‹±, íŠ¸ëœì­ì…˜ |

### ğŸ” ê° Advice ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

#### **1. @Before Advice**
```java
@Aspect
@Component
public class SecurityAspect {
    
    @Before("execution(* com.example.service.*.*(..))")
    public void checkSecurity(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println("ë³´ì•ˆ ì²´í¬: " + methodName + " ë©”ì†Œë“œ ì‹¤í–‰ ì „");
        
        // ì‹¤ì œ ë³´ì•ˆ ë¡œì§
        if (!hasPermission()) {
            throw new SecurityException("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤");
        }
    }
}
```

#### **2. @After Advice**
```java
@Aspect
@Component
public class LoggingAspect {
    
    @After("execution(* com.example.service.*.*(..))")
    public void logAfter(JoinPoint joinPoint) {
        System.out.println("ë©”ì†Œë“œ ì‹¤í–‰ ì™„ë£Œ: " + joinPoint.getSignature().getName());
        // ì˜ˆì™¸ ë°œìƒ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ì‹¤í–‰ë¨
    }
}
```

#### **3. @AfterReturning Advice**
```java
@Aspect
@Component
public class SuccessLoggingAspect {
    
    @AfterReturning(value = "execution(* com.example.service.*.*(..))", returning = "result")
    public void logSuccess(JoinPoint joinPoint, Object result) {
        System.out.println("ë©”ì†Œë“œ ì •ìƒ ì™„ë£Œ: " + joinPoint.getSignature().getName());
        System.out.println("ë°˜í™˜ê°’: " + result);
        // ì •ìƒ ì‹¤í–‰ëœ ê²½ìš°ì—ë§Œ ì‹¤í–‰ë¨
    }
}
```

#### **4. @AfterThrowing Advice**
```java
@Aspect
@Component
public class ExceptionHandlingAspect {
    
    @AfterThrowing(value = "execution(* com.example.service.*.*(..))", throwing = "exception")
    public void handleException(JoinPoint joinPoint, Exception exception) {
        System.out.println("ì˜ˆì™¸ ë°œìƒ: " + joinPoint.getSignature().getName());
        System.out.println("ì˜ˆì™¸ ë©”ì‹œì§€: " + exception.getMessage());
        
        // ì˜ˆì™¸ ì•Œë¦¼ ë°œì†¡, ë¡œê·¸ ì €ì¥ ë“±
        sendErrorNotification(exception);
    }
}
```

#### **5. @Around Advice** - **ğŸŒŸ ê°€ì¥ ê°•ë ¥!**
```java
@Aspect
@Component
public class PerformanceAspect {
    
    @Around("execution(* com.example.service.*.*(..))")
    public Object measurePerformance(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        
        System.out.println("ë©”ì†Œë“œ ì‹¤í–‰ ì‹œì‘: " + joinPoint.getSignature().getName());
        
        try {
            // ì‹¤ì œ ë©”ì†Œë“œ ì‹¤í–‰
            Object result = joinPoint.proceed();
            
            long endTime = System.currentTimeMillis();
            System.out.println("ë©”ì†Œë“œ ì‹¤í–‰ ì™„ë£Œ: " + (endTime - startTime) + "ms");
            
            return result;
        } catch (Exception e) {
            System.out.println("ë©”ì†Œë“œ ì‹¤í–‰ ì¤‘ ì˜ˆì™¸ ë°œìƒ: " + e.getMessage());
            throw e;
        }
    }
}
```

---

## âœ… Pointcut í‘œí˜„ì‹ ì™„ì „ë¶„ì„

> **ì–´ë–¤ ë©”ì†Œë“œì— Adviceë¥¼ ì ìš©í• ì§€ ê²°ì •í•˜ëŠ” í‘œí˜„ì‹**

### ğŸ“Œ ê¸°ë³¸ ë¬¸ë²• êµ¬ì¡°

```text
execution(ë¦¬í„´íƒ€ì… íŒ¨í‚¤ì§€ê²½ë¡œ í´ë˜ìŠ¤ëª… ë©”ì†Œë“œëª… ë° ë§¤ê°œë³€ìˆ˜)
```

**ì˜ˆì‹œ:**
```text
execution(* com.springbook.biz..*Impl.*(..))
         â†‘    â†‘              â†‘     â†‘   â†‘
     ë¦¬í„´íƒ€ì…  íŒ¨í‚¤ì§€ê²½ë¡œ        í´ë˜ìŠ¤ëª… ë©”ì†Œë“œëª… ë§¤ê°œë³€ìˆ˜
```

---

### ğŸ”§ ë¦¬í„´íƒ€ì… ì§€ì •

| í‘œí˜„ì‹     | ì„¤ëª…                     | ì˜ˆì‹œ                           |
| ------- | ---------------------- | ---------------------------- |
| `*`     | **ëª¨ë“  ë¦¬í„´íƒ€ì…** í—ˆìš©         | `execution(* service.*(..))`   |
| `void`  | ë¦¬í„´íƒ€ì…ì´ **void**ì¸ ë©”ì„œë“œë§Œ ì„ íƒ | `execution(void service.*(..))` |
| `!void` | ë¦¬í„´íƒ€ì…ì´ **voidê°€ ì•„ë‹Œ** ë©”ì„œë“œë§Œ ì„ íƒ | `execution(!void service.*(..))` |

---

### ğŸ”§ íŒ¨í‚¤ì§€ ì§€ì •

| í‘œí˜„ì‹                        | ì„¤ëª…                                    | ì˜ˆì‹œ                              |
| -------------------------- | ------------------------------------- | ------------------------------- |
| `com.springbook.biz`       | **ì •í™•í•˜ê²Œ ì¼ì¹˜**í•˜ëŠ” íŒ¨í‚¤ì§€ë§Œ ì„ íƒ                 | ë”± í•´ë‹¹ íŒ¨í‚¤ì§€ë§Œ                      |
| `com.springbook.biz..`     | `com.springbook.biz` **íŒ¨í‚¤ì§€ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“ ** íŒ¨í‚¤ì§€ | í•˜ìœ„ íŒ¨í‚¤ì§€ ëª¨ë‘ í¬í•¨                   |
| `com.springbook..impl`     | `com.springbook` ì‹œì‘í•˜ë©´ì„œ **ë§ˆì§€ë§‰ì´ implë¡œ ëë‚˜ëŠ”** íŒ¨í‚¤ì§€ | `com.springbook.user.impl` ë“±    |

---

### ğŸ”§ í´ë˜ìŠ¤ ì§€ì •

| í‘œí˜„ì‹                | ì„¤ëª…                                 | ì˜ˆì‹œ                           |
| ------------------ | ---------------------------------- | ---------------------------- |
| `BoardServiceImpl` | **ì •í™•í•˜ê²Œ BoardServiceImpl** í´ë˜ìŠ¤ë§Œ ì„ íƒ   | íŠ¹ì • í´ë˜ìŠ¤ë§Œ ëŒ€ìƒ                  |
| `*Impl`            | í´ë˜ìŠ¤ ì´ë¦„ì´ **Implë¡œ ëë‚˜ëŠ”** í´ë˜ìŠ¤ë§Œ ì„ íƒ      | UserServiceImpl, BoardServiceImpl |
| `BoardService+`    | **í•´ë‹¹ í´ë˜ìŠ¤ì˜ ëª¨ë“  ìì‹ í´ë˜ìŠ¤** ë˜ëŠ” **ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´** | ìƒì†/êµ¬í˜„ ê´€ê³„ ëª¨ë‘ í¬í•¨              |

---

### ğŸ”§ ë©”ì†Œë“œ ì§€ì •

| í‘œí˜„ì‹       | ì„¤ëª…                         | ì˜ˆì‹œ                           |
| --------- | -------------------------- | ---------------------------- |
| `*()`     | **ëª¨ë“  ë©”ì„œë“œ** ì„ íƒ              | ë©”ì†Œë“œëª… ìƒê´€ì—†ì´ ëª¨ë‘                |
| `get*(..)`  | ë©”ì†Œë“œ ì´ë¦„ì´ **getìœ¼ë¡œ ì‹œì‘í•˜ëŠ”** ëª¨ë“  ë©”ì†Œë“œ | getUser(), getUserList() ë“±  |
| `*User(..)` | ë©”ì†Œë“œ ì´ë¦„ì´ **Userë¡œ ëë‚˜ëŠ”** ëª¨ë“  ë©”ì†Œë“œ  | registerUser(), deleteUser() ë“± |

---

### ğŸ”§ ë§¤ê°œë³€ìˆ˜ ì§€ì •

| í‘œí˜„ì‹                           | ì„¤ëª…                                   | ì˜ˆì‹œ                           |
| ----------------------------- | ------------------------------------ | ---------------------------- |
| `(..)`                        | **ë§¤ê°œë³€ìˆ˜ ê°œìˆ˜ì™€ íƒ€ì…ì— ì œì•½ ì—†ìŒ** (ê°€ì¥ ê¸°ë³¸)       | ë§¤ê°œë³€ìˆ˜ ìƒê´€ì—†ì´ ëª¨ë‘                |
| `(*)`                         | **ë°˜ë“œì‹œ 1ê°œì˜ ë§¤ê°œë³€ìˆ˜**ë¥¼ ê°€ì§€ëŠ” ë©”ì„œë“œë§Œ ì„ íƒ        | íŒŒë¼ë¯¸í„° 1ê°œì§œë¦¬ ë©”ì†Œë“œë§Œ              |
| `(com.springbook.user.UserVO)` | **ë§¤ê°œë³€ìˆ˜ê°€ UserVO**ë¥¼ ê°€ì§€ëŠ” ë©”ì„œë“œë§Œ ì„ íƒ (íŒ¨í‚¤ì§€ ê²½ë¡œ í¬í•¨) | UserVO íŒŒë¼ë¯¸í„°ë¥¼ ë°›ëŠ” ë©”ì†Œë“œë§Œ         |
| `(!com.springbook.user.UserVO)` | **ë§¤ê°œë³€ìˆ˜ê°€ UserVOê°€ ì•„ë‹Œ** ë©”ì„œë“œë§Œ ì„ íƒ         | UserVOê°€ ì•„ë‹Œ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ëŠ” ë©”ì†Œë“œë§Œ     |
| `(Integer, ..)`               | **ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ê°€ Integer**ì´ê³  **1ê°œ ì´ìƒ**ì¸ ë©”ì„œë“œ | ì²« ë²ˆì§¸ê°€ Integerì¸ ë©”ì†Œë“œ           |
| `(Integer, *)`                | **ë°˜ë“œì‹œ 2ê°œ ë§¤ê°œë³€ìˆ˜**ì´ê³  **ì²« ë²ˆì§¸ê°€ Integer**ì¸ ë©”ì„œë“œ | ì •í™•íˆ 2ê°œ íŒŒë¼ë¯¸í„°, ì²« ë²ˆì§¸ê°€ Integer  |

---

### ğŸ¯ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œë“¤

```java
@Aspect
@Component
public class ComprehensiveAspect {
    
    // 1. ëª¨ë“  ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œ
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void allServiceMethods() {}
    
    // 2. getìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ë©”ì†Œë“œ
    @Pointcut("execution(* com.example..*.get*(..))")
    public void allGetMethods() {}
    
    // 3. UserServiceì˜ íŠ¹ì • ë©”ì†Œë“œ
    @Pointcut("execution(* com.example.service.UserService.findById(Long))")
    public void userFindByIdMethod() {}
    
    // 4. Implë¡œ ëë‚˜ëŠ” ëª¨ë“  í´ë˜ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œ
    @Pointcut("execution(* com.example..*Impl.*(..))")
    public void allImplMethods() {}
    
    // 5. void ë¦¬í„´ íƒ€ì… ë©”ì†Œë“œë§Œ
    @Pointcut("execution(void com.example.service.*.*(..))")
    public void voidMethods() {}
    
    // 6. ì—¬ëŸ¬ ì¡°ê±´ ì¡°í•©
    @Before("allServiceMethods() && allGetMethods()")
    public void beforeServiceGetMethods() {
        System.out.println("ì„œë¹„ìŠ¤ì˜ get ë©”ì†Œë“œ ì‹¤í–‰ ì „");
    }
}
```

---

## ğŸ“Œ ë‹¤ì–‘í•œ Pointcut ì§€ì •ì

### ğŸ”§ Pointcut ì§€ì •ì ì¢…ë¥˜

| ì§€ì •ì          | ì„¤ëª…                        | ì˜ˆì‹œ                              |
| ------------ | ------------------------- | ------------------------------- |
| `execution`  | **ë©”ì„œë“œ ê¸°ì¤€**ìœ¼ë¡œ í¬ì¸íŠ¸ì»· ì„¤ì •       | `execution(* service.*.*(..))`    |
| `within`     | **íŠ¹ì • íƒ€ì…(í´ë˜ìŠ¤) ê¸°ì¤€**ìœ¼ë¡œ ì„¤ì •     | `within(com.example.service.*)`   |
| `this`       | **ì£¼ì–´ì§„ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ê°ì²´** ëŒ€ìƒ    | `this(com.example.UserService)`   |
| `args`       | **íŠ¹ì • íŒŒë¼ë¯¸í„°**ë¥¼ ê°€ì§€ëŠ” ëŒ€ìƒë§Œ      | `args(java.lang.String)`          |
| `@annotation` | **íŠ¹ì • ì–´ë…¸í…Œì´ì…˜**ì´ ì ìš©ëœ ëŒ€ìƒë§Œ     | `@annotation(Transactional)`      |

### ğŸ¯ ì‹¤ì œ í™œìš© ì˜ˆì‹œ

```java
@Aspect
@Component
public class AdvancedPointcutAspect {
    
    // 1. execution ì‚¬ìš©
    @Before("execution(* com.example.service.*.*(..))")
    public void beforeServiceMethods() {}
    
    // 2. within ì‚¬ìš© - íŠ¹ì • íŒ¨í‚¤ì§€ ë‚´ ëª¨ë“  ë©”ì†Œë“œ
    @Before("within(com.example.service..*)")
    public void beforeServicePackage() {}
    
    // 3. @annotation ì‚¬ìš© - íŠ¹ì • ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì†Œë“œë§Œ
    @Around("@annotation(org.springframework.transaction.annotation.Transactional)")
    public Object aroundTransactional(ProceedingJoinPoint joinPoint) throws Throwable {
        System.out.println("íŠ¸ëœì­ì…˜ ë©”ì†Œë“œ ì‹¤í–‰");
        return joinPoint.proceed();
    }
    
    // 4. args ì‚¬ìš© - íŠ¹ì • íƒ€ì… íŒŒë¼ë¯¸í„°ë¥¼ ë°›ëŠ” ë©”ì†Œë“œë§Œ
    @Before("args(java.lang.String)")
    public void beforeStringParameter() {}
    
    // 5. ì¡°í•© ì‚¬ìš©
    @Before("execution(* com.example.service.*.*(..)) && args(java.lang.Long)")
    public void beforeServiceWithLongParam() {}
}
```

---

## âœ… JoinPointì™€ ProceedingJoinPoint

### ğŸ“Œ JoinPoint ë©”ì„œë“œ

> **ì‹¤í–‰ì¤‘ì¸ ë©”ì†Œë“œì˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ê°ì²´**

| ë©”ì„œë“œ              | ì„¤ëª…                                 | ë°˜í™˜ íƒ€ì…       |
| ---------------- | ---------------------------------- | ----------- |
| `getSignature()` | **ë©”ì†Œë“œì˜ ì‹œê·¸ë‹ˆì²˜**(ë¦¬í„´íƒ€ì…, ì´ë¦„, ë§¤ê°œë³€ìˆ˜) ì •ë³´ ë¦¬í„´ | `Signature` |
| `getTarget()`    | **ë©”ì†Œë“œë¥¼ í¬í•¨í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ê°ì²´** ë¦¬í„´           | `Object`    |
| `getArgs()`      | **ë©”ì†Œë“œ í˜¸ì¶œ ì‹œ ë„˜ê²¨ì¤€ ì¸ì ëª©ë¡**ì„ ë°°ì—´ë¡œ ë¦¬í„´     | `Object[]`  |

### ğŸ“Œ Signature ë©”ì„œë“œ

| ë©”ì„œë“œ               | ì„¤ëª…                              | ë°˜í™˜ íƒ€ì…    |
| ----------------- | ------------------------------- | -------- |
| `getName()`       | **ë©”ì†Œë“œ ì´ë¦„** ë¦¬í„´                   | `String` |
| `toLongString()`  | **ë©”ì†Œë“œì˜ ëª¨ë“  ì •ë³´**(íŒ¨í‚¤ì§€ ê²½ë¡œê¹Œì§€) í¬í•¨í•˜ì—¬ ë¦¬í„´ | `String` |
| `toShortString()` | **ë©”ì†Œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ì¶•ì•½í•œ ë¬¸ìì—´**ë¡œ ë¦¬í„´       | `String` |

### ğŸ“Œ ProceedingJoinPoint (Aroundì—ì„œë§Œ ì‚¬ìš©)

| ë©”ì„œë“œ         | ì„¤ëª…              | ë°˜í™˜ íƒ€ì…    |
| ----------- | --------------- | -------- |
| `proceed()` | **ì‹¤ì œ ë©”ì†Œë“œë¥¼ ì‹¤í–‰** | `Object` |

### ğŸ“ JoinPoint í™œìš© ì‹¤ì „ ì˜ˆì‹œ

```java
@Aspect
@Component
@Slf4j
public class DetailedLoggingAspect {
    
    @Before("execution(* com.example.service.*.*(..))")
    public void logMethodInfo(JoinPoint joinPoint) {
        // ë©”ì†Œë“œ ì‹œê·¸ë‹ˆì²˜ ì •ë³´
        Signature signature = joinPoint.getSignature();
        String methodName = signature.getName();
        String className = signature.getDeclaringType().getSimpleName();
        
        // ë©”ì†Œë“œ íŒŒë¼ë¯¸í„°
        Object[] args = joinPoint.getArgs();
        
        // ëŒ€ìƒ ê°ì²´
        Object target = joinPoint.getTarget();
        
        log.info("=== ë©”ì†Œë“œ ì‹¤í–‰ ì •ë³´ ===");
        log.info("í´ë˜ìŠ¤: {}", className);
        log.info("ë©”ì†Œë“œ: {}", methodName);
        log.info("íŒŒë¼ë¯¸í„° ê°œìˆ˜: {}", args.length);
        log.info("íŒŒë¼ë¯¸í„°: {}", Arrays.toString(args));
        log.info("ëŒ€ìƒ ê°ì²´: {}", target.getClass().getSimpleName());
        log.info("ì „ì²´ ì‹œê·¸ë‹ˆì²˜: {}", signature.toLongString());
        log.info("ì¶•ì•½ ì‹œê·¸ë‹ˆì²˜: {}", signature.toShortString());
    }
    
    @AfterReturning(value = "execution(* com.example.service.*.*(..))", returning = "result")
    public void logMethodReturn(JoinPoint joinPoint, Object result) {
        String methodName = joinPoint.getSignature().getName();
        log.info("ë©”ì†Œë“œ [{}] ì •ìƒ ì™„ë£Œ, ë°˜í™˜ê°’: {}", methodName, result);
    }
    
    @Around("execution(* com.example.service.*.*(..))")
    public Object logMethodPerformance(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().getName();
        long startTime = System.currentTimeMillis();
        
        log.info("ë©”ì†Œë“œ [{}] ì‹¤í–‰ ì‹œì‘", methodName);
        
        try {
            // ì‹¤ì œ ë©”ì†Œë“œ ì‹¤í–‰
            Object result = joinPoint.proceed();
            
            long endTime = System.currentTimeMillis();
            log.info("ë©”ì†Œë“œ [{}] ì‹¤í–‰ ì™„ë£Œ, ì‹¤í–‰ì‹œê°„: {}ms", methodName, (endTime - startTime));
            
            return result;
        } catch (Exception e) {
            long endTime = System.currentTimeMillis();
            log.error("ë©”ì†Œë“œ [{}] ì‹¤í–‰ ì‹¤íŒ¨, ì‹¤í–‰ì‹œê°„: {}ms, ì—ëŸ¬: {}", 
                     methodName, (endTime - startTime), e.getMessage());
            throw e;
        }
    }
}
```

---

## âœ… AOP ì„¤ì • ë°©ë²•

### ğŸ”§ 1. XML ê¸°ë°˜ ì„¤ì •

```xml
<!-- servlet-context.xml -->
<aop:config>
    <aop:pointcut id="allPointcut" 
                  expression="execution(* com.springbook..*Impl.*(..))" />
    
    <aop:aspect ref="logAdvice">
        <aop:before method="printLogging" pointcut-ref="allPointcut"/>
        <aop:after method="afterLogging" pointcut-ref="allPointcut"/>
    </aop:aspect>
</aop:config>

<bean id="logAdvice" class="com.example.LogAdvice" />
```

### ğŸ”§ 2. ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ ì„¤ì • - **ğŸŒŸ ê¶Œì¥!**

```java
@Aspect
@Component
public class LogAdvice {
    
    @Pointcut("execution(* com.example..*Impl.*(..))")
    public void allPointcut() {}
    
    @Before("allPointcut()")
    public void printLogging(JoinPoint joinPoint) {
        System.out.println("ì‹¤í–‰ëœ ë©”ì†Œë“œ: " + joinPoint.getSignature().getName());
    }
    
    @After("allPointcut()")
    public void afterLogging(JoinPoint joinPoint) {
        System.out.println("ë©”ì†Œë“œ ì‹¤í–‰ ì™„ë£Œ: " + joinPoint.getSignature().getName());
    }
}
```

### ğŸ”§ 3. Java Config ì„¤ì •

```java
@Configuration
@EnableAspectJAutoProxy
public class AopConfig {
    
    @Bean
    public LogAdvice logAdvice() {
        return new LogAdvice();
    }
}
```

---

## ğŸ¯ ì‹¤ë¬´ì—ì„œ AOP í™œìš© íŒ¨í„´

### ğŸ”§ 1. ë¡œê¹… (Logging)

```java
@Aspect
@Component
@Slf4j
public class LoggingAspect {
    
    @Around("execution(* com.example.service.*.*(..))")
    public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        String methodName = joinPoint.getSignature().getName();
        
        log.info("=== {} ë©”ì†Œë“œ ì‹œì‘ ===", methodName);
        
        try {
            Object result = joinPoint.proceed();
            
            long endTime = System.currentTimeMillis();
            log.info("=== {} ë©”ì†Œë“œ ì™„ë£Œ ({}ms) ===", methodName, (endTime - startTime));
            
            return result;
        } catch (Exception e) {
            long endTime = System.currentTimeMillis();
            log.error("=== {} ë©”ì†Œë“œ ì‹¤íŒ¨ ({}ms): {} ===", 
                     methodName, (endTime - startTime), e.getMessage());
            throw e;
        }
    }
}
```

### ğŸ”§ 2. íŠ¸ëœì­ì…˜ ê´€ë¦¬

```java
@Aspect
@Component
public class TransactionAspect {
    
    @Around("@annotation(org.springframework.transaction.annotation.Transactional)")
    public Object manageTransaction(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().getName();
        
        System.out.println("íŠ¸ëœì­ì…˜ ì‹œì‘: " + methodName);
        
        try {
            Object result = joinPoint.proceed();
            System.out.println("íŠ¸ëœì­ì…˜ ì»¤ë°‹: " + methodName);
            return result;
        } catch (Exception e) {
            System.out.println("íŠ¸ëœì­ì…˜ ë¡¤ë°±: " + methodName);
            throw e;
        }
    }
}
```

### ğŸ”§ 3. ë³´ì•ˆ ì²´í¬

```java
@Aspect
@Component
public class SecurityAspect {
    
    @Before("@annotation(com.example.annotation.RequiredRole)")
    public void checkSecurity(JoinPoint joinPoint) {
        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸
        String currentUser = SecurityContextHolder.getContext()
                                .getAuthentication().getName();
        
        // ê¶Œí•œ ì²´í¬ ë¡œì§
        if (!hasPermission(currentUser, joinPoint)) {
            throw new SecurityException("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤: " + currentUser);
        }
        
        System.out.println("ë³´ì•ˆ ì²´í¬ ì™„ë£Œ: " + currentUser);
    }
    
    private boolean hasPermission(String user, JoinPoint joinPoint) {
        // ì‹¤ì œ ê¶Œí•œ ì²´í¬ ë¡œì§
        return user != null && !user.equals("anonymous");
    }
}

// ì‚¬ìš©ë²•
@RequiredRole("ADMIN")
public void deleteUser(Long id) {
    userRepository.deleteById(id);
}
```

### ğŸ”§ 4. ìºì‹±

```java
@Aspect
@Component
public class CacheAspect {
    
    private Map<String, Object> cache = new ConcurrentHashMap<>();
    
    @Around("@annotation(com.example.annotation.Cacheable)")
    public Object cacheResult(ProceedingJoinPoint joinPoint) throws Throwable {
        String key = generateKey(joinPoint);
        
        // ìºì‹œì—ì„œ ì¡°íšŒ
        if (cache.containsKey(key)) {
            System.out.println("ìºì‹œì—ì„œ ë°˜í™˜: " + key);
            return cache.get(key);
        }
        
        // ë©”ì†Œë“œ ì‹¤í–‰ í›„ ìºì‹œì— ì €ì¥
        Object result = joinPoint.proceed();
        cache.put(key, result);
        System.out.println("ìºì‹œì— ì €ì¥: " + key);
        
        return result;
    }
    
    private String generateKey(ProceedingJoinPoint joinPoint) {
        StringBuilder keyBuilder = new StringBuilder();
        keyBuilder.append(joinPoint.getSignature().getName());
        
        Object[] args = joinPoint.getArgs();
        for (Object arg : args) {
            keyBuilder.append("_").append(arg.toString());
        }
        
        return keyBuilder.toString();
    }
}

// ì‚¬ìš©ë²•
@Cacheable
public User getUserById(Long id) {
    return userRepository.findById(id);
}
```

### ğŸ”§ 5. API í˜¸ì¶œ ì œí•œ (Rate Limiting)

```java
@Aspect
@Component
public class RateLimitAspect {
    
    private Map<String, Integer> requestCounts = new ConcurrentHashMap<>();
    private Map<String, Long> lastRequestTime = new ConcurrentHashMap<>();
    private static final int MAX_REQUESTS = 10; // ìµœëŒ€ ìš”ì²­ ìˆ˜
    private static final long TIME_WINDOW = 60000; // 1ë¶„ (ë°€ë¦¬ì´ˆ)
    
    @Before("@annotation(com.example.annotation.RateLimit)")
    public void checkRateLimit(JoinPoint joinPoint) {
        String clientId = getCurrentClientId(); // í´ë¼ì´ì–¸íŠ¸ ì‹ë³„
        String key = clientId + "_" + joinPoint.getSignature().getName();
        
        long currentTime = System.currentTimeMillis();
        
        // ì‹œê°„ ìœˆë„ìš° ì²´í¬
        if (lastRequestTime.containsKey(key)) {
            long timeDiff = currentTime - lastRequestTime.get(key);
            if (timeDiff > TIME_WINDOW) {
                requestCounts.put(key, 0); // ì¹´ìš´íŠ¸ ë¦¬ì…‹
            }
        }
        
        // ìš”ì²­ ìˆ˜ ì¦ê°€
        int currentCount = requestCounts.getOrDefault(key, 0) + 1;
        requestCounts.put(key, currentCount);
        lastRequestTime.put(key, currentTime);
        
        // ì œí•œ ì²´í¬
        if (currentCount > MAX_REQUESTS) {
            throw new RuntimeException("API í˜¸ì¶œ ì œí•œ ì´ˆê³¼: " + clientId);
        }
        
        System.out.println("API í˜¸ì¶œ í—ˆìš©: " + clientId + " (" + currentCount + "/" + MAX_REQUESTS + ")");
    }
}
```

---

## âš ï¸ AOP ì‚¬ìš© ì‹œ ì£¼ì˜ì 

### ğŸ§± 1. ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ

```java
// âŒ ë„ˆë¬´ ê´‘ë²”ìœ„í•œ í¬ì¸íŠ¸ì»· - ì„±ëŠ¥ì— ì˜í–¥
@Around("execution(* *.*(..))")  // ëª¨ë“  ë©”ì†Œë“œì— ì ìš©
public Object logEverything(ProceedingJoinPoint joinPoint) throws Throwable {
    // ëª¨ë“  ë©”ì†Œë“œ í˜¸ì¶œë§ˆë‹¤ ì‹¤í–‰ë¨ â†’ ì„±ëŠ¥ ì €í•˜
    return joinPoint.proceed();
}

// âœ… ì ì ˆí•œ ë²”ìœ„ì˜ í¬ì¸íŠ¸ì»·
@Around("execution(* com.example.service.*.*(..))")  // ì„œë¹„ìŠ¤ ë ˆì´ì–´ë§Œ
public Object logServiceMethods(ProceedingJoinPoint joinPoint) throws Throwable {
    // í•„ìš”í•œ ê³³ì—ë§Œ ì ìš©
    return joinPoint.proceed();
}
```

### ğŸ’¾ 2. ë””ë²„ê¹…ì˜ ì–´ë ¤ì›€

```java
// ì‹¤ì œ í˜¸ì¶œë˜ëŠ” ê²ƒì€ í”„ë¡ì‹œ ê°ì²´
@Service
public class UserService {
    public void registerUser(User user) {
        // ë””ë²„ê¹… ì‹œ ì´ ë©”ì†Œë“œì— ì§ì ‘ ë“¤ì–´ì˜¤ì§€ ì•Šê³ 
        // AOP í”„ë¡ì‹œë¥¼ ê±°ì³ì„œ ë“¤ì–´ì˜´
        userRepository.save(user);
    }
}

// ë””ë²„ê¹… íŒ: JoinPoint ì •ë³´ í™œìš©
@Before("execution(* com.example.service.*.*(..))")
public void debugInfo(JoinPoint joinPoint) {
    System.out.println("ì‹¤ì œ í˜¸ì¶œë˜ëŠ” í´ë˜ìŠ¤: " + joinPoint.getTarget().getClass());
    System.out.println("í”„ë¡ì‹œ í´ë˜ìŠ¤: " + joinPoint.getThis().getClass());
}
```

### ğŸ› ï¸ 3. ìˆœí™˜ ì°¸ì¡° ì£¼ì˜

```java
// âŒ ì˜ëª»ëœ ì˜ˆ: ë¬´í•œ ë£¨í”„ ë°œìƒ ê°€ëŠ¥
@Aspect
@Component
public class BadAspect {
    
    @Autowired
    private UserService userService;
    
    @Before("execution(* com.example.service.*.*(..))")
    public void beforeAdvice() {
        // userServiceë„ AOP ëŒ€ìƒì´ë©´ ë¬´í•œ ë£¨í”„!
        userService.logActivity();  
    }
}

// âœ… í•´ê²° ë°©ë²• 1: í¬ì¸íŠ¸ì»· ë²”ìœ„ ì¡°ì •
@Before("execution(* com.example.service.*.*(..)) && !execution(* *.logActivity(..))")
public void beforeAdvice() {
    userService.logActivity();
}

// âœ… í•´ê²° ë°©ë²• 2: ë³„ë„ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ ì‚¬ìš©
@Component
public class LoggingUtil {  // AOP ëŒ€ìƒì´ ì•„ë‹Œ í´ë˜ìŠ¤
    public void logActivity() {
        System.out.println("í™œë™ ë¡œê·¸");
    }
}
```

### ğŸ”§ 4. private ë©”ì†Œë“œëŠ” AOP ì ìš© ë¶ˆê°€

```java
@Service
public class UserService {
    
    @Before("execution(* com.example.service.*.*(..))")  // ì´ê±´ ì ìš© ì•ˆë¨!
    private void validateUser(User user) {
        // private ë©”ì†Œë“œëŠ” í”„ë¡ì‹œë¡œ ê°ìŒ€ ìˆ˜ ì—†ìŒ
    }
    
    public void registerUser(User user) {
        validateUser(user);  // ì§ì ‘ í˜¸ì¶œ, AOP ì ìš© ì•ˆë¨
        userRepository.save(user);
    }
}

// âœ… í•´ê²° ë°©ë²•: public ë©”ì†Œë“œë¡œ ë³€ê²½í•˜ê±°ë‚˜ ë³„ë„ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬
@Component
public class UserValidator {
    public void validateUser(User user) {
        // ë³„ë„ ì»´í¬ë„ŒíŠ¸ì˜ public ë©”ì†Œë“œ â†’ AOP ì ìš© ê°€ëŠ¥
    }
}
```

---

## âœ… AOP vs OOP ë¹„êµ

| êµ¬ë¶„       | **OOP**                 | **AOP**                    |
| -------- | ----------------------- | -------------------------- |
| **ê´€ì‹¬ì‚¬**  | í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§             | íš¡ë‹¨ ê´€ì‹¬ì‚¬ (ë¡œê¹…, ë³´ì•ˆ, íŠ¸ëœì­ì…˜)      |
| **ë¶„ë¦¬ ë°©ë²•** | í´ë˜ìŠ¤, ìƒì†, ë‹¤í˜•ì„±           | Aspect, Advice, Pointcut    |
| **ì¥ì **   | ê°ì²´ ì§€í–¥ì  ì„¤ê³„, ì¬ì‚¬ìš©ì„±        | ê´€ì‹¬ì‚¬ ë¶„ë¦¬, ì½”ë“œ ì¤‘ë³µ ì œê±°           |
| **ë‹¨ì **   | íš¡ë‹¨ ê´€ì‹¬ì‚¬ ì²˜ë¦¬ ì–´ë ¤ì›€          | ë³µì¡ì„± ì¦ê°€, ë””ë²„ê¹… ì–´ë ¤ì›€            |
| **ì ìš© ì‹œì ** | ì»´íŒŒì¼ ì‹œì                 | ëŸ°íƒ€ì„ ì‹œì  (í”„ë¡ì‹œ)              |

---

## ğŸ“š AOP í•µì‹¬ ìš”ì•½

| ê°œë…            | ì„¤ëª…                           |
| ------------- | ---------------------------- |
| **ê´€ì‹¬ì‚¬ ë¶„ë¦¬**    | í•µì‹¬ ë¡œì§ê³¼ ë¶€ê°€ ê¸°ëŠ¥ì„ ë¶„ë¦¬            |
| **Aspect**    | ê³µí†µ ë¡œì§ì„ ëª¨ì•„ë†“ì€ í´ë˜ìŠ¤             |
| **Advice**    | ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” ë¶€ê°€ ê¸°ëŠ¥ ë©”ì†Œë“œ           |
| **Pointcut**  | ì–´ë””ì— ì ìš©í• ì§€ ê²°ì •í•˜ëŠ” í‘œí˜„ì‹          |
| **JoinPoint** | ì‹¤ì œ Adviceê°€ ì ìš©ë˜ëŠ” ë©”ì†Œë“œ         |
| **Weaving**   | Aspectì™€ ëŒ€ìƒ ê°ì²´ë¥¼ ì—°ê²°í•˜ëŠ” ê³¼ì •      |
| **Proxy**     | ìŠ¤í”„ë§ì´ ìƒì„±í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´           |

---

## ğŸ§  AOP ì ìš© íë¦„

```text
1. @Aspect í´ë˜ìŠ¤ ìƒì„±
   â†“
2. @Pointcutìœ¼ë¡œ ëŒ€ìƒ ë©”ì†Œë“œ ì§€ì •
   â†“
3. @Before/@After/@Around ë“±ìœ¼ë¡œ Advice ì •ì˜
   â†“
4. ìŠ¤í”„ë§ì´ í”„ë¡ì‹œ ê°ì²´ ìƒì„± (Weaving)
   â†“
5. í´ë¼ì´ì–¸íŠ¸ê°€ í”„ë¡ì‹œ ê°ì²´ í˜¸ì¶œ
   â†“
6. í”„ë¡ì‹œê°€ Advice ì‹¤í–‰ í›„ ì‹¤ì œ ë©”ì†Œë“œ í˜¸ì¶œ
   â†“
7. ê²°ê³¼ ë°˜í™˜
```

---

## ğŸ¯ ì‹¤ì œ í”„ë¡œì íŠ¸ ì ìš© ì˜ˆì‹œ

```java
// ê²Œì‹œíŒ ì„œë¹„ìŠ¤ì— AOP ì ìš©
@Service
@Transactional
public class BoardService {
    
    @RateLimit
    @Cacheable
    public List<Board> getBoardList(int page) {
        return boardRepository.findAll(page);
    }
    
    @RequiredRole("USER")
    public void createBoard(Board board) {
        boardRepository.save(board);
    }
    
    @RequiredRole("ADMIN")
    public void deleteBoard(Long id) {
        boardRepository.deleteById(id);
    }
}

// ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ì ìš©ë˜ëŠ” ê²ƒë“¤:
// 1. RateLimitAspect â†’ API í˜¸ì¶œ ì œí•œ ì²´í¬
// 2. CacheAspect â†’ ìºì‹œ í™•ì¸ ë° ì €ì¥
// 3. SecurityAspect â†’ ê¶Œí•œ ì²´í¬
// 4. TransactionAspect â†’ íŠ¸ëœì­ì…˜ ê´€ë¦¬
// 5. LoggingAspect â†’ ì‹¤í–‰ ë¡œê·¸ ê¸°ë¡
// 6. ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì†Œë“œ ì‹¤í–‰
```

---

## âš¡ AOP ì‹¤ì „ ê¿€íŒ

### ğŸ”§ 1. Pointcut ì¬ì‚¬ìš©

```java
@Aspect
@Component
public class CommonPointcuts {
    
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceLayer() {}
    
    @Pointcut("execution(* com.example.repository.*.*(..))")
    public void repositoryLayer() {}
    
    @Pointcut("@annotation(org.springframework.transaction.annotation.Transactional)")
    public void transactionalMethods() {}
}

// ë‹¤ë¥¸ Aspectì—ì„œ ì¬ì‚¬ìš©
@Aspect
@Component
public class LoggingAspect {
    
    @Before("com.example.aspect.CommonPointcuts.serviceLayer()")
    public void logServiceMethods() {
        // ê³µí†µ í¬ì¸íŠ¸ì»· ì¬ì‚¬ìš©
    }
}
```

### ğŸ”§ 2. ì¡°ê±´ë¶€ Advice

```java
@Aspect
@Component
public class ConditionalAspect {
    
    @Around("execution(* com.example.service.*.*(..))")
    public Object conditionalLogging(ProceedingJoinPoint joinPoint) throws Throwable {
        // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ë¡œê¹…
        if (isDevEnvironment()) {
            System.out.println("DEV ëª¨ë“œ: " + joinPoint.getSignature().getName());
        }
        
        return joinPoint.proceed();
    }
    
    private boolean isDevEnvironment() {
        return "dev".equals(System.getProperty("spring.profiles.active"));
    }
}
```

### ğŸ”§ 3. ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ AOP

```java
// ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ ì •ì˜
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface LogExecutionTime {
    String value() default "";
}

// í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì†Œë“œë§Œ ì²˜ë¦¬
@Aspect
@Component
public class AnnotationBasedAspect {
    
    @Around("@annotation(logExecutionTime)")
    public Object logTime(ProceedingJoinPoint joinPoint, LogExecutionTime logExecutionTime) throws Throwable {
        long start = System.currentTimeMillis();
        
        Object result = joinPoint.proceed();
        
        long end = System.currentTimeMillis();
        String message = logExecutionTime.value().isEmpty() ? 
                        joinPoint.getSignature().getName() : logExecutionTime.value();
        
        System.out.println(message + " ì‹¤í–‰ì‹œê°„: " + (end - start) + "ms");
        
        return result;
    }
}

// ì‚¬ìš©ë²•
@LogExecutionTime("ì‚¬ìš©ì ì¡°íšŒ")
public User getUserById(Long id) {
    return userRepository.findById(id);
}
```

---

## ğŸ“š ì°¸ê³ ìë£Œ

* ã€ìŠ¤í”„ë§ AOPã€ ê°•ì˜ ìë£Œ
* Spring Framework ê³µì‹ ë¬¸ì„œ
* AspectJ í”„ë¡œê·¸ë˜ë° ê°€ì´ë“œ
* https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop

> ì´ ê¸€ì€ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ **AOP ê°œë…ê³¼ ì‹¤ì œ í™œìš© ë°©ë²•ì„ ëª…í™•í•˜ê²Œ ì „ë‹¬**í•˜ê¸° ìœ„í•´
> ê°•ì˜ ìë£Œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ëœ í•™ìŠµ ìë£Œì…ë‹ˆë‹¤. ğŸ˜Š