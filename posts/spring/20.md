# π΅ μ¤ν”„λ§ ν”„λ μ„μ›ν¬ - (2) IoC/DI

## β… IoC(Inversion of Control)λ€?

> **μ μ–΄μ μ—­μ „**! κ°μ²΄μ μƒμ„±κ³Ό κ΄€λ¦¬μ— λ€ν• **μ μ–΄κ¶μ΄ λ°”λ€λ”** κ²ƒ!
> μ¦‰, **κ°λ°μκ°€ μ§μ ‘ κ°μ²΄λ¥Ό λ§λ“λ” κ² μ•„λ‹λΌ μ¤ν”„λ§μ΄ λ€μ‹  λ§λ“¤μ–΄μ¤**!

### μ™ IoCκ°€ ν•„μ”ν• κΉ?

| κΈ°μ΅΄ λ°©μ‹ (β)              | IoC λ°©μ‹ (β…)               |
| ----------------------- | ------------------------ |
| `B b = new B()` μ§μ ‘ μƒμ„±   | `@Autowired B b` μλ™ μ£Όμ…   |
| μ½”λ“μ— μμ΅΄μ„±μ΄ ν•λ“μ½”λ”©λ¨         | μ„¤μ •μΌλ΅ μμ΅΄μ„± κ΄€λ¦¬              |
| λ³€κ²½ μ‹ μ†μ¤μ½”λ“ μμ • ν•„μ”        | μ„¤μ •λ§ λ°”κΎΈλ©΄ OK               |
| ν…μ¤νΈν•κΈ° μ–΄λ ¤μ›€              | Mock κ°μ²΄ μ£Όμ…μΌλ΅ ν…μ¤νΈ μ‰¬μ›€      |

---

## π“ IoC μ»¨ν…μ΄λ„λ€?

> **κ°μ²΄λ¥Ό μƒμ„±ν•κ³  μ΅°λ¦½(μ£Όμ…)ν•΄μ£Όλ” μ—­ν• **μ„ ν•λ” **μ¤ν”„λ§μ ν•µμ‹¬ κΈ°λ¥**!

### π”§ μ»¨ν…μ΄λ„κ°€ ν•λ” μΌ

* μ»¨ν…μ΄λ„μ—μ„ **κ°μ²΄λ¥Ό μƒμ„±ν•κ³  μ΅°λ¦½(μ£Όμ…)ν•λ” μ—­ν• **
* μ»¨ν…μ΄λ„κ°€ κ΄€λ¦¬ν•λ” κ°μ²΄λ¥Ό **λΉ(Bean)**μ΄λΌκ³  ν•¨
* **μΈν„°νμ΄μ¤ μƒμ†μ„ ν†µν•΄ λ¶€ν’ν™”** β†’ κ°μ•„λΌμ°κΈ° μ‰¬μ›€!

#### π― μμ‹λ΅ μ΄ν•΄ν•κΈ°

```java
class A {
    B b;  // B νƒ€μ…μ κ°μ²΄κ°€ ν•„μ”ν•¨
}
```

**κΈ°μ΅΄ λ°©μ‹:**
```java
// A ν΄λμ¤ μ•μ—μ„
B b = new B();  // μ§μ ‘ μƒμ„± β†’ κ°•ν• κ²°ν•©
```

**IoC λ°©μ‹:**
```java
// μ¤ν”„λ§μ΄ μ•μ•„μ„
@Autowired B b;  // μ»¨ν…μ΄λ„μ—μ„ B κ°μ²΄λ¥Ό μ°Ύμ•„μ„ μ£Όμ…
```

μ΄λ ‡κ² ν•λ©΄ **IoC μ»¨ν…μ΄λ„**κ°€ `new B1()`, `new B2()` κ°™μ€ κµ¬ν„μ²΄λ“¤μ„ λ§λ“¤μ–΄λ†“κ³ , ν•„μ”ν•  λ• Aμ—κ² μ£Όμ…ν•΄μ¤!

---

## β… DI(Dependency Injection) μ™„μ „λ¶„μ„

> **μμ΅΄μ„± μ£Όμ…**! ν•„μ”ν• κ°μ²΄λ¥Ό **μ™Έλ¶€μ—μ„ μ£Όμ…λ°›λ”** λ°©μ‹!

### π“ DIμ ν•µμ‹¬ κ°λ…

* **Dependency**: Aκ°€ Bλ¥Ό μ‚¬μ©ν•λ‹¤ = Aλ” Bμ— μμ΅΄ν•λ‹¤
* **Injection**: μ™Έλ¶€μ—μ„ κ°μ²΄λ¥Ό μ£Όμ…ν•΄μ¤€λ‹¤
* **κ²°ν•©λ„λ¥Ό λ‚®μ¶”κ³ ** **μ μ—°μ„±μ„ λ†’μ΄λ”** κ²ƒμ΄ λ©ν‘!

---

## π”· DI μ£Όμ… λ°©μ‹ 3κ°€μ§€

### β… 1. μƒμ„±μ μ£Όμ… (Constructor Injection) - **π κ¶μ¥!**

```java
public class UserService {
    private final UserRepository userRepository;
    
    // μƒμ„±μλ¥Ό ν†µν•΄ μ£Όμ…
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

#### π”Ή μƒμ„±μ μ£Όμ…μ„ κ¶μ¥ν•λ” μ΄μ 

| μ¥μ                        | μ„¤λ…                           |
| ------------------------ | ---------------------------- |
| β… **λ¶λ³€μ„± λ³΄μ¥**            | `final`λ΅ μ„ μ–Έ κ°€λ¥ β†’ λ³€κ²½ λ¶κ°€λ¥      |
| β… **μμ΅΄κ΄€κ³„ μ„¤μ •μ€ λ‹¨ ν•λ²λ§**     | κ°μ²΄ μƒμ„± μ‹μ μ— ν• λ²λ§ μ„¤μ •λ¨         |
| β… **μ»΄νμΌ μ—λ¬λ΅ λ„λ½ λ°©μ§€**      | ν•„μ μμ΅΄μ„±μ΄ μ—†μΌλ©΄ μ»΄νμΌ μ—λ¬ λ°μƒ      |
| β… **μν™ μ°Έμ΅° λ°©μ§€**           | Aβ†’B, Bβ†’A κ°™μ€ λ¬Έμ λ¥Ό μ‚¬μ „μ— μ°¨λ‹¨     |

---

### β… 2. Setter μ£Όμ… (Setter Injection)

```java
public class UserService {
    private UserRepository userRepository;
    
    @Autowired
    public void setUserRepository(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

#### β οΈ Setter μ£Όμ…μ λ‹¨μ 

* ν•­μƒ **λ³€κ²½ κ°€λ¥μ„±**μ΄ μ—΄λ ¤μμ
* **μ„ νƒμ  μμ΅΄μ„±**μ—λ§ μ‚¬μ© κ¶μ¥

---

### β… 3. ν•„λ“ μ£Όμ… (Field Injection)

```java
public class UserService {
    @Autowired
    private UserRepository userRepository;
}
```

#### β ν•„λ“ μ£Όμ…μ λ¬Έμ μ 

* **ν…μ¤νΈν•κΈ° μ–΄λ ¤μ›€** β†’ Mock μ£Όμ…μ΄ λ³µμ΅
* **μμ΅΄μ„±μ΄ μ¨κ²¨μ§** β†’ μ½”λ“λ§μΌλ΅ μμ΅΄κ΄€κ³„ νμ•… μ–΄λ ¤μ›€
* **ν”„λ μ„μ›ν¬ μΆ…μ†μ ** β†’ μ¤ν”„λ§ μ—†μ΄λ” λ™μ‘ λ¶κ°€

---

## β… DI μ„¤μ • λ°©λ²• 3κ°€μ§€

### π”§ 1. XML κΈ°λ° μ„¤μ •

```xml
<beans>
    <bean id="userRepository" class="com.example.UserRepositoryImpl"/>
    <bean id="userService" class="com.example.UserService">
        <constructor-arg ref="userRepository"/>
    </bean>
</beans>
```

#### νΉμ§•

* **μ„¤μ •κ³Ό μ½”λ“ λ¶„λ¦¬** β†’ λ³€κ²½ μ‹ μ»΄νμΌ λ¶ν•„μ”
* **κ°€λ…μ„±μ΄ λ–¨μ–΄μ§** β†’ XMLμ΄ λ³µμ΅ν•΄μ§ μ μμ

---

### π”§ 2. Java κΈ°λ° μ„¤μ •

```java
@Configuration
public class AppConfig {
    
    @Bean
    public UserRepository userRepository() {
        return new UserRepositoryImpl();
    }
    
    @Bean
    public UserService userService() {
        return new UserService(userRepository());
    }
}
```

#### νΉμ§•

* **νƒ€μ… μ•μ •μ„±** β†’ μ»΄νμΌ μ‹μ μ— μ¤λ¥ μ²΄ν¬
* **λ¦¬ν©ν† λ§ μ§€μ›** β†’ IDEμ λ„μ›€ λ°›κΈ° μ‰¬μ›€

---

### π”§ 3. μ–΄λ…Έν…μ΄μ… κΈ°λ° μ„¤μ • - **π κ°€μ¥ λ§μ΄ μ‚¬μ©!**

#### π“ μμ΅΄μ„± μ£Όμ… μ–΄λ…Έν…μ΄μ…

| μ–΄λ…Έν…μ΄μ…      | μ„¤λ…                           | μ°μ„ μμ„ |
| ---------- | ---------------------------- | ---- |
| `@Autowired` | **νƒ€μ…**μΌλ΅ μλ™ μ£Όμ…               | νƒ€μ… μ°μ„  |
| `@Qualifier` | νΉμ • **μ΄λ¦„**μΌλ΅ λΉ μ§€μ •             | μ΄λ¦„ μ§€μ • |
| `@Resource`  | `@Autowired` + `@Qualifier` κΈ°λ¥ | μ΄λ¦„ μ°μ„  |
| `@Inject`    | `@Autowired`μ™€ λ™μΌν• κΈ°λ¥         | ν‘μ¤€ JSR |

#### π“ λΉ λ“±λ΅ μ–΄λ…Έν…μ΄μ…

| μ–΄λ…Έν…μ΄μ…        | μ©λ„                    | μμ‹             |
| ------------ | --------------------- | -------------- |
| `@Component`   | **μΌλ°μ μΈ** μ¤ν”„λ§ λΉ λ“±λ΅     | μ ν‹Έλ¦¬ν‹° ν΄λμ¤       |
| `@Controller`  | **μ›Ή μ»¨νΈλ΅¤λ¬** ν΄λμ¤        | REST API μ»¨νΈλ΅¤λ¬ |
| `@Service`     | **λΉ„μ¦λ‹μ¤ λ΅μ§** μ²λ¦¬ ν΄λμ¤    | μ„λΉ„μ¤ λ μ΄μ–΄        |
| `@Repository`  | **λ°μ΄ν„° μ ‘κ·Ό** ν΄λμ¤ (DAO)  | DB μ ‘κ·Ό λ μ΄μ–΄      |

#### π” μ»΄ν¬λ„νΈ μ¤μΊ” μ„¤μ •

```java
@ComponentScan(basePackages = "com.example")
public class AppConfig {
    // μ§€μ •λ ν¨ν‚¤μ§€μ—μ„ @Component κ³„μ—΄ μ–΄λ…Έν…μ΄μ…μ„ μ°Ύμ•„μ„ μλ™ λ“±λ΅
}
```

---

## π“ κ²°ν•©λ„ λ‚®μ¶”κΈ°: μΈν„°νμ΄μ¤ ν™μ©

### β κ°•ν• κ²°ν•© (Bad)

```java
public class UserService {
    private MySQLUserRepository repository = new MySQLUserRepository();
    // MySQLμ— κ°•ν•κ² μμ΅΄ β†’ λ‹¤λ¥Έ DBλ΅ λ³€κ²½ν•λ ¤λ©΄ μ½”λ“ μμ • ν•„μ”
}
```

### β… μ•½ν• κ²°ν•© (Good)

```java
public interface UserRepository {
    User findById(Long id);
}

public class UserService {
    private final UserRepository repository;
    
    public UserService(UserRepository repository) {
        this.repository = repository;  // μΈν„°νμ΄μ¤μ— μμ΅΄
    }
}
```

μ΄μ  `MySQLUserRepository`, `PostgreSQLUserRepository`, `MongoUserRepository` λ“± **μ–΄λ–¤ κµ¬ν„μ²΄λ“  κ°μ•„λΌμΈ μ μμ–΄**!

---

## β οΈ DI μ‚¬μ© μ‹ μ£Όμμ 

### π§± 1. μν™ μ°Έμ΅° λ¬Έμ 

```java
@Service
public class AService {
    @Autowired private BService bService;  // Aκ°€ Bλ¥Ό μ°Έμ΅°
}

@Service  
public class BService {
    @Autowired private AService aService;  // Bκ°€ Aλ¥Ό μ°Έμ΅° β†’ μν™!
}
```

#### ν•΄κ²° λ°©λ²•

* **@Lazy** μ–΄λ…Έν…μ΄μ… μ‚¬μ©
* **κµ¬μ΅° μ¬μ„¤κ³„** (λ€λ¶€λ¶„ μ„¤κ³„ λ¬Έμ μ„)

---

### π’Ύ 2. μ„±λ¥ vs μ μ—°μ„±

* **DIλ” λ°νƒ€μ„μ— μμ΅΄μ„±μ„ μ£Όμ…** β†’ μ•½κ°„μ μ„±λ¥ μ¤λ²„ν—¤λ“
* ν•μ§€λ§ **μ μ§€λ³΄μμ„±κ³Ό ν…μ¤νΈ μ©μ΄μ„±**μ μ¥μ μ΄ ν›¨μ”¬ νΌ!

---

### π› οΈ 3. κ³Όλ„ν• μ¶”μƒν™” μ£Όμ

* λ¨λ“  ν΄λμ¤λ¥Ό μΈν„°νμ΄μ¤λ΅ λ§λ“¤ ν•„μ”λ” μ—†μ–΄
* **λ³€κ²½ κ°€λ¥μ„±μ΄ μλ” λ¶€λ¶„**μ—λ§ μΈν„°νμ΄μ¤ μ μ©ν•λ” κ² μΆ‹μ

---

## β… μ‹¤λ¬΄μ—μ„ DI ν¨ν„΄

### π― λ μ΄μ–΄λ³„ μμ΅΄μ„± νλ¦„

```text
Controller β†’ Service β†’ Repository
     β†“         β†“         β†“
  (μ›Ή μ”μ²­)  (λΉ„μ¦λ‹μ¤)   (DB μ ‘κ·Ό)
```

### π“ μ‹¤μ  μ½”λ“ μμ‹

```java
@RestController
public class UserController {
    private final UserService userService;
    
    public UserController(UserService userService) {
        this.userService = userService;
    }
    
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
}

@Service
public class UserService {
    private final UserRepository userRepository;
    
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
    
    public User findById(Long id) {
        return userRepository.findById(id);
    }
}

@Repository
public class UserRepositoryImpl implements UserRepository {
    // DB μ ‘κ·Ό λ΅μ§
}
```

---

## π“ DI ν•µμ‹¬ μ”μ•½

| κ°λ…           | μ„¤λ…                         |
| ------------ | -------------------------- |
| **IoC**      | μ μ–΄κ¶μ„ μ¤ν”„λ§μ—κ² λ„κΉ€              |
| **DI**       | ν•„μ”ν• κ°μ²΄λ¥Ό μ™Έλ¶€μ—μ„ μ£Όμ…λ°›μ          |
| **λμ¨ν• κ²°ν•©**   | μΈν„°νμ΄μ¤λ¥Ό ν†µν• μμ΅΄μ„± κ΄€λ¦¬           |
| **μƒμ„±μ μ£Όμ…**   | κ°€μ¥ κ¶μ¥λλ” μ£Όμ… λ°©μ‹             |
| **μ»΄ν¬λ„νΈ μ¤μΊ”**  | μ–΄λ…Έν…μ΄μ…μΌλ΅ μλ™ λΉ λ“±λ΅           |

---

## π§  μ „μ²΄ νλ¦„ μ •λ¦¬

```text
1. μ»΄ν¬λ„νΈ μ¤μΊ”μΌλ΅ λΉ λ“±λ΅
   β†“
2. μμ΅΄κ΄€κ³„ λ¶„μ„
   β†“  
3. μƒμ„±μ μ£Όμ…μΌλ΅ DI
   β†“
4. μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ κ°μ²΄ κ΄€λ¦¬
```

---

## π“ μ°Έκ³ μλ£

* γ€μ¤ν”„λ§ ν”„λ μ„μ›ν¬γ€ κ°•μ μλ£
* IoC/DI κ°λ… μ •λ¦¬

> μ΄ κΈ€μ€ μ¤ν”„λ§ ν”„λ μ„μ›ν¬μ **IoC/DI κ°λ…μ„ λ…ν™•ν•κ² μ „λ‹¬**ν•κΈ° μ„ν•΄
> κ°•μ μλ£λ¥Ό λ°”νƒ•μΌλ΅ μ‘μ„±λ ν•™μµ μλ£μ…λ‹λ‹¤. π