# ğŸŸ¡ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ - (10) Spring Security

## ğŸ’¡ Spring Securityë€?

> ìŠ¤í”„ë§ ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ì¸ì¦(Authentication)**ê³¼ **ì¸ê°€(Authorization)**ë¥¼ ë‹´ë‹¹í•˜ëŠ” ìŠ¤í”„ë§ì˜ í•˜ìœ„ í”„ë ˆì„ì›Œí¬ì˜ˆìš”!

Spring SecurityëŠ” ê°•ë ¥í•˜ê³  ë†’ì€ ìˆ˜ì¤€ì˜ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•œ ì¸ì¦ ë° ì ‘ê·¼ ì œì–´ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. Spring ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³´í˜¸í•˜ê¸° ìœ„í•œ í‘œì¤€ì´ë¼ê³  í•  ìˆ˜ ìˆì–´ìš”!

> **Servlet Filter** ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•´ì„œ Spring MVCì™€ ë¶„ë¦¬ë˜ì–´ ê´€ë¦¬ë˜ê³  ë™ì‘í•´ìš”! ğŸ˜Š

---

## ğŸ“˜ í•µì‹¬ ê°œë… ì´í•´í•˜ê¸°

### ğŸ” ì¸ì¦(Authentication) vs ì¸ê°€(Authorization)

| êµ¬ë¶„ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **ì¸ì¦(Authentication)** | "ë‹¹ì‹ ì´ ëˆ„êµ¬ì¸ê°€ìš”?" | ë¡œê·¸ì¸ â†’ ì‚¬ìš©ì ì‹ ì› í™•ì¸ |
| **ì¸ê°€(Authorization)** | "ë‹¹ì‹ ì´ ì´ê²ƒì„ í•  ìˆ˜ ìˆë‚˜ìš”?" | ê´€ë¦¬ìë§Œ íšŒì› ì‚­ì œ ê°€ëŠ¥ |
| **ë¡¤(Role)** | ì‚¬ìš©ìì˜ ê¶Œí•œ ê·¸ë£¹ | USER, ADMIN, MANAGER |

```java
// ì¸ì¦: ë¡œê·¸ì¸ ì •ë³´ í™•ì¸
if (username.equals("admin") && password.equals("1234")) {
    // ì¸ì¦ ì„±ê³µ
}

// ì¸ê°€: ê¶Œí•œ í™•ì¸
if (user.hasRole("ADMIN")) {
    // ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ í—ˆìš©
}
```

### ğŸ¯ Spring Security ì£¼ìš” íŠ¹ì§•

* **í¬ê´„ì ì¸ ì¸ì¦ ì§€ì›**: HTTP BASIC, Form ë¡œê·¸ì¸, OAuth ë“±
* **ì„¸ë°€í•œ ì¸ê°€ ì œì–´**: URL íŒ¨í„´, ë©”ì„œë“œ ë‹¨ìœ„ ê¶Œí•œ ì œì–´
* **ë‹¤ì–‘í•œ ì €ì¥ì†Œ ì§€ì›**: ë©”ëª¨ë¦¬, ë°ì´í„°ë² ì´ìŠ¤, LDAP ë“±
* **CSRF ë³´í˜¸**: Cross-Site Request Forgery ê³µê²© ë°©ì§€
* **ì„¸ì…˜ ê´€ë¦¬**: ë™ì‹œ ì„¸ì…˜ ì œì–´, ì„¸ì…˜ ê³ ì • ê³µê²© ë°©ì§€

---

## ğŸ”§ Servlet Filter ê¸°ë°˜ ì•„í‚¤í…ì²˜

### ğŸ“Š Spring Security Filter Chain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Request   â”‚â”€â”€â”€â–¶â”‚     Spring Security Filters    â”‚â”€â”€â”€â–¶â”‚ Servlet  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ›¡ï¸ ì£¼ìš” Security Filterë“¤

| Filter | ì—­í•  |
|--------|------|
| `SecurityContextPersistenceFilter` | SecurityContextë¥¼ ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ ì €ì¥ |
| `LogoutFilter` | ë¡œê·¸ì•„ì›ƒ URL ìš”ì²­ ê°ì‹œ ë° ì²˜ë¦¬ |
| `UsernamePasswordAuthenticationFilter` | ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ í¼ ì¸ì¦ ì²˜ë¦¬ |
| `DefaultLoginPageGeneratingFilter` | ê¸°ë³¸ ë¡œê·¸ì¸ í¼ í˜ì´ì§€ ìƒì„± |
| `BasicAuthenticationFilter` | HTTP Basic ì¸ì¦ í—¤ë” ì²˜ë¦¬ |
| `RequestCacheAwareFilter` | ë¡œê·¸ì¸ ì„±ê³µ í›„ ì›ë˜ ìš”ì²­ ì •ë³´ ì¬êµ¬ì„± |
| `AnonymousAuthenticationFilter` | ìµëª… ì‚¬ìš©ì ì²˜ë¦¬ |
| `SessionManagementFilter` | ì¸ì¦ëœ ì‚¬ìš©ìì˜ ì„¸ì…˜ ì¶”ì  |
| `ExceptionTranslationFilter` | ë³´ì•ˆ ì˜ˆì™¸ ì²˜ë¦¬ ë° ì „ë‹¬ |
| `FilterSecurityInterceptor` | ì ‘ê·¼ ì œì–´ ê²°ì • (ìµœì¢… ë‹¨ê³„) |

---

## ğŸ—ï¸ Spring Security ì„¤ì •í•˜ê¸°

### âœï¸ 1. ì˜ì¡´ì„± ì¶”ê°€

```xml
<!-- pom.xml -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-test</artifactId>
    <scope>test</scope>
</dependency>
```

### âœï¸ 2. Security Configuration í´ë˜ìŠ¤

```java
@Configuration
@EnableWebSecurity
public class SpringSecurityConfig {
    
    // ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
    // ë©”ëª¨ë¦¬ ê¸°ë°˜ ì‚¬ìš©ì ì •ë³´ (í…ŒìŠ¤íŠ¸ìš©)
    @Bean
    public InMemoryUserDetailsManager inMemoryUserDetailsService() {
        UserDetails user = User.builder()
                .username("user1")
                .password(passwordEncoder().encode("1234"))
                .roles("USER") // ROLE_USER
                .build();
        
        UserDetails admin = User.builder()
                .username("admin1")
                .password(passwordEncoder().encode("1234"))
                .authorities("ROLE_ADMIN", "ROLE_USER")
                .build();
        
        return new InMemoryUserDetailsManager(user, admin);
    }
}
```

### âœï¸ 3. SecurityFilterChain ì„¤ì •

```java
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
        // URLë³„ ì ‘ê·¼ ê¶Œí•œ ì„¤ì •
        .authorizeHttpRequests(authorize -> authorize
            .dispatcherTypeMatchers(DispatcherType.FORWARD).permitAll()
            .requestMatchers("/", "/all").permitAll()
            .requestMatchers("/user/**").hasAnyRole("USER", "ADMIN")
            .requestMatchers("/admin/**").hasAuthority("ROLE_ADMIN")
            .anyRequest().authenticated()
        )
        // í¼ ë¡œê·¸ì¸ ì„¤ì •
        .formLogin(formLogin -> formLogin
            .usernameParameter("username")
            .defaultSuccessUrl("/all")
        )
        // ë¡œê·¸ì•„ì›ƒ ì„¤ì •
        .logout(logout -> logout
            .logoutSuccessUrl("/all")
            .invalidateHttpSession(true)
            .deleteCookies("JSESSIONID")
        );
    
    return http.build();
}

// ì •ì  ë¦¬ì†ŒìŠ¤ ì˜ˆì™¸ ì²˜ë¦¬
@Bean
public WebSecurityCustomizer webSecurityCustomizer() {
    return (web) -> web.ignoring()
        .requestMatchers("/images/**", "/js/**", "/css/**");
}
```

---

## ğŸ­ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë·° êµ¬ì„±

### âœï¸ SampleController

```java
@Controller
public class SampleController {
    
    @GetMapping("all")
    public void all() {} // templates/all.html
    
    @GetMapping("user")
    public void user() {} // templates/user.html
    
    @GetMapping("admin")
    public void admin() {} // templates/admin.html
}
```

### âœï¸ Thymeleaf ë·° í…œí”Œë¦¿

```html
<!-- all.html -->
<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>ë©”ì¸ í˜ì´ì§€</title>
</head>
<body>
    <h1>ë©”ì¸ í˜ì´ì§€ì…ë‹ˆë‹¤.</h1>
    
    <ul>
        <li>
            <a th:href="@{/user}">ì¼ë°˜ ì‚¬ìš©ììš© í˜ì´ì§€ë¡œ</a>
        </li>
        <li sec:authorize="hasRole('ADMIN')">
            <a th:href="@{/admin}">ê´€ë¦¬ì ì „ìš© í˜ì´ì§€ë¡œ</a>
        </li>
    </ul>
    
    <th:block sec:authorize="isAuthenticated()">
        <p>ì‚¬ìš©ìëª…: <span sec:authentication="name"></span></p>
        <p>ê¶Œí•œ: <span sec:authentication="principal.authorities"></span></p>
        
        <form th:action="@{/logout}" method="post">
            <button type="submit">ë¡œê·¸ì•„ì›ƒ</button>
        </form>
    </th:block>
</body>
</html>
```

---

## ğŸ—ƒï¸ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ì¸ì¦

### âœï¸ 1. í…Œì´ë¸” êµ¬ì¡° ì„¤ê³„

```sql
-- ì—­í•  í…Œì´ë¸”
CREATE TABLE t_role (
    id NUMBER PRIMARY KEY,
    role_name VARCHAR2(100) NOT NULL,
    description VARCHAR2(100)
);

-- ì‚¬ìš©ì í…Œì´ë¸”
CREATE TABLE t_user (
    id NUMBER PRIMARY KEY,
    login_id VARCHAR2(20) NOT NULL,
    password VARCHAR2(200) NOT NULL,
    full_name VARCHAR2(100) NOT NULL,
    dept_name VARCHAR2(100) NOT NULL
);

-- ì‚¬ìš©ì-ì—­í•  ë§¤í•‘ í…Œì´ë¸”
CREATE TABLE t_user_role (
    role_id NUMBER,
    user_id NUMBER,
    FOREIGN KEY (role_id) REFERENCES t_role(id),
    FOREIGN KEY (user_id) REFERENCES t_user(id),
    PRIMARY KEY(role_id, user_id)
);

-- ìƒ˜í”Œ ë°ì´í„°
INSERT INTO t_user VALUES(1, 'user', '1234', 'ì‚¬ìš©ì', 'ì¸ì‚¬');
INSERT INTO t_user VALUES(2, 'admin', '1234', 'ê´€ë¦¬ì', 'ê¸°íš');
INSERT INTO t_role VALUES(1, 'ROLE_USER', 'ì¼ë°˜ì‚¬ìš©ì');
INSERT INTO t_role VALUES(2, 'ROLE_ADMIN', 'ì‹œìŠ¤í…œê´€ë¦¬ì');
INSERT INTO t_user_role VALUES(1, 1);
INSERT INTO t_user_role VALUES(2, 2);
INSERT INTO t_user_role VALUES(1, 2);
```

### âœï¸ 2. UserVOì™€ LoginUserVO

```java
// UserVO
@Data
public class UserVO {
    private String loginId;
    private String password;
    private List<String> roleList;
}

// LoginUserVO - UserDetails êµ¬í˜„
@RequiredArgsConstructor
@Getter
public class LoginUserVO implements UserDetails {
    
    private final UserVO userVO;
    
    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        List<GrantedAuthority> auths = new ArrayList<>();
        for (String auth : userVO.getRoleList()) {
            auths.add(new SimpleGrantedAuthority(auth));
        }
        return auths;
    }
    
    @Override
    public String getPassword() {
        return userVO.getPassword();
    }
    
    @Override
    public String getUsername() {
        return userVO.getLoginId();
    }
    
    // ê¸°íƒ€ UserDetails ë©”ì„œë“œë“¤ì€ true ë°˜í™˜
    @Override
    public boolean isAccountNonExpired() { return true; }
    
    @Override
    public boolean isAccountNonLocked() { return true; }
    
    @Override
    public boolean isCredentialsNonExpired() { return true; }
    
    @Override
    public boolean isEnabled() { return true; }
}
```

### âœï¸ 3. MyBatis Mapper

```java
// UserMapper.java
public interface UserMapper {
    public UserVO getUserInfo(String id);
}
```

```xml
<!-- user-map.xml -->
<resultMap id="userInfo" type="UserVO">
    <id property="loginId" column="login_id" />
    <result property="password" column="password" />
    <collection property="roleList" ofType="string">
        <result column="role_name" />
    </collection>
</resultMap>

<select id="getUserInfo" resultMap="userInfo">
    SELECT login_id, password, role_name
    FROM t_user JOIN t_user_role ON t_user.id = t_user_role.user_id
                JOIN t_role ON t_user_role.role_id = t_role.id 
    WHERE login_id = #{id}
</select>
```

### âœï¸ 4. CustomUserDetailsService

```java
@Service
public class CustomUserDetailsService implements UserDetailsService {
    
    private final UserMapper userMapper;
    
    @Autowired
    public CustomUserDetailsService(UserMapper userMapper) {
        this.userMapper = userMapper;
    }
    
    @Override
    public UserDetails loadUserByUsername(String username) 
            throws UsernameNotFoundException {
        
        UserVO userVO = userMapper.getUserInfo(username);
        
        if (userVO == null) {
            throw new UsernameNotFoundException(username);
        }
        
        return new LoginUserVO(userVO);
    }
}
```

---

## ğŸ›¡ï¸ Thymeleaf Security í†µí•©

### âœï¸ 1. ì˜ì¡´ì„± ì¶”ê°€

```xml
<dependency>
    <groupId>org.thymeleaf.extras</groupId>
    <artifactId>thymeleaf-extras-springsecurity6</artifactId>
</dependency>
```

### âœï¸ 2. Security ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¶”ê°€

```html
<html xmlns:th="https://www.thymeleaf.org/"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
```

### âœï¸ 3. ì£¼ìš” Security ì†ì„±ë“¤

```html
<!-- ì¸ì¦ ì •ë³´ í‘œì‹œ -->
<span sec:authentication="name">ì‚¬ìš©ìëª…</span>
<span sec:authentication="principal.username">ì‚¬ìš©ìëª…</span>
<span sec:authentication="principal.authorities">ê¶Œí•œ</span>

<!-- ê¶Œí•œ ê¸°ë°˜ ì¡°ê±´ë¶€ í‘œì‹œ -->
<div sec:authorize="isAnonymous()">
    ë¡œê·¸ì¸ ì „ì—ë§Œ ë³´ì„
</div>

<div sec:authorize="isAuthenticated()">
    ë¡œê·¸ì¸ í›„ì—ë§Œ ë³´ì„
</div>

<div sec:authorize="hasRole('ADMIN')">
    ê´€ë¦¬ìë§Œ ë³´ì„
</div>

<div sec:authorize="hasAnyRole('USER', 'ADMIN')">
    USER ë˜ëŠ” ADMIN ê¶Œí•œì´ ìˆìœ¼ë©´ ë³´ì„
</div>
```

---

## ğŸ”’ CSRF(Cross-Site Request Forgery) ë³´í˜¸

### ğŸ’¡ CSRFë€?

CSRFëŠ” **ì‚¬ì´íŠ¸ ê°„ ìš”ì²­ ìœ„ì¡°** ê³µê²©ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì˜ë„í•˜ì§€ ì•Šì€ ìš”ì²­ì„ ì•…ì˜ì ì¸ ì›¹ì‚¬ì´íŠ¸ë¥¼ í†µí•´ ì „ì†¡í•˜ëŠ” ê³µê²©ì´ì—ìš”!

> Spring SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ CSRF ë³´í˜¸ë¥¼ í™œì„±í™”í•´ìš”!

### âœï¸ 1. Formì—ì„œ CSRF í† í° ìë™ ì¶”ê°€

```html
<!-- Before -->
<form th:action="@{/empInsert}" method="post">
    <input type="text" name="name">
    <button type="submit">ì €ì¥</button>
</form>

<!-- After (ìë™ìœ¼ë¡œ ì¶”ê°€ë¨) -->
<form th:action="@{/empInsert}" method="post">
    <input type="text" name="name">
    <input type="hidden" name="_csrf" value="í† í°ê°’">
    <button type="submit">ì €ì¥</button>
</form>
```

### âœï¸ 2. AJAXì—ì„œ CSRF í† í° ì‚¬ìš©

```html
<!-- HTMLì— ë©”íƒ€ íƒœê·¸ë¡œ í† í° ì •ë³´ ì¶”ê°€ -->
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
```

```javascript
// JavaScriptë¡œ CSRF í† í° ì²˜ë¦¬
const csrfHeader = $('meta[name="_csrf_header"]').attr("content");
const csrfToken = $('meta[name="_csrf"]').attr("content");

// Fetch API ì‚¬ìš©
let headers = new Headers();
headers.append('Content-Type', 'application/json');
headers.append(csrfHeader, csrfToken);

fetch("/api/data", {
    method: "POST",
    headers,
    body: JSON.stringify(dataObj)
})
.then(res => res.json())
.then(result => console.log(result));

// jQuery AJAX ì‚¬ìš©
$.ajax("/api/data", {
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify(dataObj),
    beforeSend: function(xhr) {
        xhr.setRequestHeader(csrfHeader, csrfToken);
    }
})
.done(result => console.log(result));
```

---

## ğŸ”„ Spring Security ì¸ì¦ íë¦„

### ğŸ“Š ì „ì²´ ì•„í‚¤í…ì²˜

```
1. ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œë„ (HTTP Request)
           â†“
2. AuthenticationFilterì—ì„œ ìš”ì²­ ìºì¹˜
           â†“
3. AuthenticationManagerë¥¼ í†µí•´ ì¸ì¦ ì‹¤í–‰
           â†“
4. UserDetailsServiceì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
           â†“
5. PasswordEncoderë¡œ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
           â†“
6. ì¸ì¦ ì„±ê³µ ì‹œ SecurityContextì— Authentication ì €ì¥
           â†“
7. SecurityContextHolderì— SecurityContext ì €ì¥
           â†“
8. Sessionì— SecurityContext ì €ì¥
           â†“
9. ì‘ë‹µì— JSESSIONID ì¿ í‚¤ í¬í•¨í•˜ì—¬ ì „ì†¡
```

### ğŸ¯ ì¿ í‚¤-ì„¸ì…˜ ë°©ì‹ ì¸ì¦

1. **ë¡œê·¸ì¸ ìš”ì²­**: ì‚¬ìš©ìê°€ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
2. **ì¸ì¦ ì²˜ë¦¬**: AuthenticationFilterê°€ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ì¸ì¦ ìˆ˜í–‰
3. **ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ**: DBì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ UserDetailsë¡œ ë³€í™˜
4. **ì„¸ì…˜ ìƒì„±**: ì¸ì¦ ì„±ê³µ ì‹œ ì„œë²„ì—ì„œ ì„¸ì…˜ ìƒì„±
5. **ì„¸ì…˜ ì €ì¥**: SecurityContextHolder(ì¸ë©”ëª¨ë¦¬ ì„¸ì…˜ ì €ì¥ì†Œ)ì— ì €ì¥
6. **ì¿ í‚¤ ì „ì†¡**: í´ë¼ì´ì–¸íŠ¸ì—ê²Œ JSESSIONID ì¿ í‚¤ ì „ì†¡
7. **í›„ì† ìš”ì²­**: ì¿ í‚¤ì˜ JSESSIONIDë¡œ ì„¸ì…˜ ê²€ì¦ í›„ Authentication ì œê³µ

---

## ğŸ§ª ì‹¤ë¬´ í™œìš© íŒ

### ğŸ’¡ ë©”ì„œë“œ ë ˆë²¨ ë³´ì•ˆ

```java
@Service
public class BoardService {
    
    @PreAuthorize("hasRole('ADMIN')")
    public void deleteAllBoards() {
        // ê´€ë¦¬ìë§Œ ì‹¤í–‰ ê°€ëŠ¥
    }
    
    @PreAuthorize("hasRole('USER') and #username == authentication.name")
    public void updateUserProfile(String username, UserProfile profile) {
        // ë³¸ì¸ì˜ í”„ë¡œí•„ë§Œ ìˆ˜ì • ê°€ëŠ¥
    }
    
    @PostAuthorize("returnObject.author == authentication.name")
    public Board getBoard(Long id) {
        // ìì‹ ì´ ì‘ì„±í•œ ê²Œì‹œë¬¼ë§Œ ì¡°íšŒ ê°€ëŠ¥
    }
}
```

### ğŸ¯ ì»¤ìŠ¤í…€ ì„±ê³µ/ì‹¤íŒ¨ í•¸ë“¤ëŸ¬

```java
@Component
public class CustomAuthenticationSuccessHandler 
        implements AuthenticationSuccessHandler {
    
    @Override
    public void onAuthenticationSuccess(HttpServletRequest request,
            HttpServletResponse response, Authentication authentication) 
            throws IOException, ServletException {
        
        // ë¡œê·¸ì¸ ì„±ê³µ í›„ ê¶Œí•œë³„ë¡œ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        Collection<? extends GrantedAuthority> authorities = 
            authentication.getAuthorities();
            
        for (GrantedAuthority authority : authorities) {
            if (authority.getAuthority().equals("ROLE_ADMIN")) {
                response.sendRedirect("/admin/dashboard");
                return;
            }
        }
        response.sendRedirect("/user/home");
    }
}
```

### ğŸ”§ ì„¸ì…˜ ê´€ë¦¬ ì„¤ì •

```java
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
        .sessionManagement(session -> session
            .maximumSessions(1) // ë™ì‹œ ì„¸ì…˜ 1ê°œë¡œ ì œí•œ
            .maxSessionsPreventsLogin(false) // ê¸°ì¡´ ì„¸ì…˜ ë§Œë£Œ
            .sessionRegistry(sessionRegistry())
        );
    return http.build();
}
```

---

## ğŸ“š ì°¸ê³  ìë£Œ (References)

* [Spring Security ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-security/reference/)
  â†’ https://docs.spring.io/spring-security/reference/
* [Thymeleaf + Spring Security í†µí•© ê°€ì´ë“œ](https://www.thymeleaf.org/doc/articles/springsecurity.html)
  â†’ https://www.thymeleaf.org/doc/articles/springsecurity.html
* [Spring Security Architecture](https://spring.io/guides/topicals/spring-security-architecture)
  â†’ https://spring.io/guides/topicals/spring-security-architecture
* [OWASP CSRF Prevention](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
  â†’ https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html
* **ChatGPT (OpenAI)** â€“ Spring Security ì‹¤ë¬´ ì˜ˆì œ ë° ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€ êµ¬ì„± ë„ì›€

> Spring Securityë¥¼ í™œìš©í•œ **ê°•ë ¥í•˜ê³  ìœ ì—°í•œ ë³´ì•ˆ ì‹œìŠ¤í…œ** êµ¬ì¶• ë°©ë²•ì„ ìì„¸íˆ ì•Œì•„ë´¤ì–´ìš”! ì²˜ìŒì—” ë³µì¡í•´ ë³´ì´ì§€ë§Œ **ì¸ì¦ê³¼ ì¸ê°€ì˜ ê°œë…**ì„ ëª…í™•íˆ ì´í•´í•˜ê³ , **Filter Chainì˜ ë™ì‘ ì›ë¦¬**ë¥¼ íŒŒì•…í•˜ë©´ í›¨ì”¬ ì‰¬ì›Œì§‘ë‹ˆë‹¤. **ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ì¸ì¦**ê³¼ **ì„¸ë°€í•œ ê¶Œí•œ ì œì–´**ê°€ í•„ìˆ˜ì´ë‹ˆê¹Œ ì°¨ê·¼ì°¨ê·¼ ì—°ìŠµí•´ë³´ì‹œê¸¸ ë°”ë˜ìš”! ë‹¤ìŒì—ëŠ” **OAuth2**ì™€ **JWT í† í° ê¸°ë°˜ ì¸ì¦**ë„ ë‹¤ë¤„ë³¼ê²Œìš”! ğŸ˜Š